This file is a merged representation of the entire codebase, combined into a single document.
Generated by Repomix on: 2025-12-25T01:02:41.562Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded

Additional Info:
----------------

================================================================
Directory Structure
================================================================
.gitignore
backend/alembic.ini
backend/alembic/env.py
backend/alembic/README
backend/alembic/script.py.mako
backend/alembic/versions/222cf417b60f_add_recipe_and_ingredient_tables.py
backend/alembic/versions/2e7a324c567a_add_is_selected_to_recipes.py
backend/alembic/versions/c5256c589d3e_create_user_table.py
backend/alembic/versions/e7b5cb225a11_add_inventory_table.py
backend/app/api/deps.py
backend/app/api/endpoints/auth.py
backend/app/api/endpoints/grocery.py
backend/app/api/endpoints/ingredients.py
backend/app/api/endpoints/inventory.py
backend/app/api/endpoints/recipes.py
backend/app/core/config.py
backend/app/core/security.py
backend/app/db/base.py
backend/app/db/session.py
backend/app/main.py
backend/app/models/ingredient.py
backend/app/models/inventory.py
backend/app/models/recipe.py
backend/app/models/user.py
backend/app/schemas/inventory.py
backend/app/schemas/recipe.py
backend/app/schemas/token.py
backend/app/schemas/user.py
backend/app/seed_ingredients.py
backend/app/utils/grocery_logic.py
backend/app/utils/suggestion_logic.py
backend/requirements.txt
docker-compose.yml
web/.gitignore
web/eslint.config.mjs
web/next.config.ts
web/package.json
web/postcss.config.mjs
web/public/file.svg
web/public/globe.svg
web/public/next.svg
web/public/vercel.svg
web/public/window.svg
web/README.md
web/repomix-output.txt
web/src/app/[id]/page.tsx
web/src/app/globals.css
web/src/app/grocery-list/page.tsx
web/src/app/inventory/page.tsx
web/src/app/layout.tsx
web/src/app/login/page.tsx
web/src/app/page.tsx
web/src/app/recipes/new/page.tsx
web/src/app/register/page.tsx
web/src/app/what-can-i-cook/page.tsx
web/src/context/AuthContext.tsx
web/src/lib/api.ts
web/src/lib/providers.tsx
web/tsconfig.json

================================================================
Files
================================================================

================
File: .gitignore
================
# ==========================
# GLOBAL / IDE
# ==========================
.DS_Store
Thumbs.db
.vscode/
.idea/
*.log

# ==========================
# BACKEND (Python/FastAPI)
# ==========================
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
dist/
*.egg-info/
.installed.cfg
*.egg

# Virtual Environment
venv/
env/
.venv/
backend/venv/

# Environment Variables (IMPORTANT)
.env
.env.*
!.env.example
backend/.env

# Database
*.sqlite3
*.db
postgres_data/

# ==========================
# FRONTEND (Next.js/Node)
# ==========================
node_modules/
web/node_modules/
.next/
web/.next/
web/out/
web/build/
web/dist/

# Next.js Environment
.env.local
.env.development.local
.env.test.local
.env.production.local
web/.env.local
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# Typescript
*.tsbuildinfo

================
File: backend/alembic.ini
================
# A generic, single database configuration.

[alembic]
# path to migration scripts
script_location = alembic

# template used to generate migration files
# file_template = %%(rev)s_%%(slug)s

# sys.path path, will be prepended to sys.path if present.
# defaults to the current working directory.
prepend_sys_path = .

# timezone to use when rendering the date within the migration file
# as well as the filename.
# string value is passed to dateutil.tz.gettz()
# leave blank for localtime
# timezone =

# max length of characters for slug field in migration filename
# truncate_slug_length = 40

# set to 'true' to run the environment during
# the 'revision' command, regardless of autogenerate
# revision_environment = false

# set to 'true' to allow .pyc and .pyo files without
# a source .py file to be detected as revisions in the
# versions/ directory
# sourceless = false

# version location specification; this defaults
# to alembic/versions.  When using multiple version
# directories, initial revisions must be specified with --version-path.
# version_locations = %(here)s/bar:%(here)s/bat:alembic/versions
# version_path_separator = :

# the output encoding used when revision files
# are written from script.py.mako
# output_encoding = utf-8

sqlalchemy.url = driver://user:pass@localhost/dbname


[post_write_hooks]
# post_write_hooks defines scripts or Python functions that are run
# on newly generated revision scripts.  See the documentation for further
# detail and examples

# http://alembic.zzzcomputing.com/en/latest/api/config.html#post-write-hooks

[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S

================
File: backend/alembic/env.py
================
import os
import sys
from logging.config import fileConfig

from sqlalchemy import engine_from_config
from sqlalchemy import pool

from alembic import context

# ------------------------------------------------------------------------
# 1. Add the current directory to sys.path so we can import from 'app'
#    This assumes you run alembic commands from the 'backend/' folder.
# ------------------------------------------------------------------------
sys.path.append(os.getcwd())

# 2. Import your application's settings and Base model
from app.core.config import settings
from app.db.base import Base  # This is where all models will be collected

# ------------------------------------------------------------------------
from app.models.user import User  # Import all models here so Alembic can see them
from app.models.ingredient import Ingredient  # <--- Add
from app.models.recipe import Recipe, RecipeIngredient # <--- Add
from app.models.inventory import Inventory  # <--- Add
# this is the Alembic Config object, which provides
# access to the values within the .ini file in use.
config = context.config

# 3. Overwrite the sqlalchemy.url in the config with the one from our environment settings
config.set_main_option("sqlalchemy.url", settings.DATABASE_URL)

# Interpret the config file for Python logging.
# This line sets up loggers basically.
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# 4. Set the target metadata so Alembic can see your models for autogeneration
target_metadata = Base.metadata

# other values from the config, defined by the needs of env.py,
# can be acquired:
# my_important_option = config.get_main_option("my_important_option")
# ... etc.


def run_migrations_offline() -> None:
    """Run migrations in 'offline' mode.

    This configures the context with just a URL
    and not an Engine, though an Engine is acceptable
    here as well.  By skipping the Engine creation
    we don't even need a DBAPI to be available.

    Calls to context.execute() here emit the given string to the
    script output.

    """
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()


def run_migrations_online() -> None:
    """Run migrations in 'online' mode.

    In this scenario we need to create an Engine
    and associate a connection with the context.

    """
    connectable = engine_from_config(
        config.get_section(config.config_ini_section, {}),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection, target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()


if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()

================
File: backend/alembic/README
================
Generic single-database configuration.

================
File: backend/alembic/script.py.mako
================
"""${message}

Revision ID: ${up_revision}
Revises: ${down_revision | comma,n}
Create Date: ${create_date}

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
${imports if imports else ""}

# revision identifiers, used by Alembic.
revision: str = ${repr(up_revision)}
down_revision: Union[str, Sequence[str], None] = ${repr(down_revision)}
branch_labels: Union[str, Sequence[str], None] = ${repr(branch_labels)}
depends_on: Union[str, Sequence[str], None] = ${repr(depends_on)}


def upgrade() -> None:
    """Upgrade schema."""
    ${upgrades if upgrades else "pass"}


def downgrade() -> None:
    """Downgrade schema."""
    ${downgrades if downgrades else "pass"}

================
File: backend/alembic/versions/222cf417b60f_add_recipe_and_ingredient_tables.py
================
"""add recipe and ingredient tables

Revision ID: 222cf417b60f
Revises: c5256c589d3e
Create Date: 2025-12-24 15:59:37.541621

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '222cf417b60f'
down_revision: Union[str, Sequence[str], None] = 'c5256c589d3e'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('ingredients',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('aisle', sa.String(), nullable=False),
    sa.Column('default_unit', sa.String(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ingredients_name'), 'ingredients', ['name'], unique=True)
    op.create_table('recipes',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('title', sa.String(), nullable=False),
    sa.Column('instructions', sa.Text(), nullable=True),
    sa.Column('servings', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('recipe_ingredients',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('recipe_id', sa.UUID(), nullable=False),
    sa.Column('ingredient_id', sa.UUID(), nullable=False),
    sa.Column('quantity', sa.String(), nullable=False),
    sa.Column('unit', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['ingredient_id'], ['ingredients.id'], ),
    sa.ForeignKeyConstraint(['recipe_id'], ['recipes.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('recipe_ingredients')
    op.drop_table('recipes')
    op.drop_index(op.f('ix_ingredients_name'), table_name='ingredients')
    op.drop_table('ingredients')
    # ### end Alembic commands ###

================
File: backend/alembic/versions/2e7a324c567a_add_is_selected_to_recipes.py
================
"""add is_selected to recipes

Revision ID: 2e7a324c567a
Revises: e7b5cb225a11
Create Date: 2025-12-24 17:12:25.843172

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '2e7a324c567a'
down_revision: Union[str, Sequence[str], None] = 'e7b5cb225a11'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('recipes', sa.Column('is_selected', sa.Boolean(), nullable=True))
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column('recipes', 'is_selected')
    # ### end Alembic commands ###

================
File: backend/alembic/versions/c5256c589d3e_create_user_table.py
================
"""create user table

Revision ID: c5256c589d3e
Revises: 
Create Date: 2025-12-24 15:01:30.096976

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'c5256c589d3e'
down_revision: Union[str, Sequence[str], None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('users',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_users_email'), 'users', ['email'], unique=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_users_email'), table_name='users')
    op.drop_table('users')
    # ### end Alembic commands ###

================
File: backend/alembic/versions/e7b5cb225a11_add_inventory_table.py
================
"""add inventory table

Revision ID: e7b5cb225a11
Revises: 222cf417b60f
Create Date: 2025-12-24 16:58:32.676875

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'e7b5cb225a11'
down_revision: Union[str, Sequence[str], None] = '222cf417b60f'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('inventory',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('ingredient_id', sa.UUID(), nullable=False),
    sa.Column('quantity', sa.String(), nullable=False),
    sa.Column('unit', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['ingredient_id'], ['ingredients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('inventory')
    # ### end Alembic commands ###

================
File: backend/app/api/deps.py
================
from typing import Generator, Optional
from fastapi import Depends, HTTPException, status
from fastapi.security import OAuth2PasswordBearer
from jose import jwt, JWTError
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.core.config import settings
from app.core import security
from app.models.user import User
from app.schemas.token import TokenData

# This tells FastAPI that the token comes from the "Authorization: Bearer <token>" header
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/v1/auth/login")

def get_current_user(
    db: Session = Depends(get_db),
    token: str = Depends(oauth2_scheme)
) -> User:
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="Could not validate credentials",
        headers={"WWW-Authenticate": "Bearer"},
    )
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        user_id: str = payload.get("sub")
        if user_id is None:
            raise credentials_exception
        token_data = TokenData(id=user_id)
    except JWTError:
        raise credentials_exception
        
    user = db.query(User).filter(User.id == token_data.id).first()
    if user is None:
        raise credentials_exception
    return user

================
File: backend/app/api/endpoints/auth.py
================
from datetime import timedelta
from typing import Any
from fastapi import APIRouter, Depends, HTTPException, status
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.orm import Session

from app.db.session import get_db
from app.core import security
from app.core.config import settings
from app.models.user import User
from app.schemas.user import UserCreate, UserResponse
from app.schemas.token import Token

router = APIRouter()

@router.post("/register", response_model=UserResponse)
def register(
    user_in: UserCreate,
    db: Session = Depends(get_db)
) -> Any:
    """
    Create new user.
    """
    # 1. Check if user already exists
    user = db.query(User).filter(User.email == user_in.email).first()
    if user:
        raise HTTPException(
            status_code=400,
            detail="The user with this username already exists in the system.",
        )
    
    # 2. Create new user
    user = User(
        email=user_in.email,
        password_hash=security.get_password_hash(user_in.password)
    )
    db.add(user)
    db.commit()
    db.refresh(user)
    return user

@router.post("/login", response_model=Token)
def login_access_token(
    db: Session = Depends(get_db),
    form_data: OAuth2PasswordRequestForm = Depends()
) -> Any:
    """
    OAuth2 compatible token login, get an access token for future requests.
    """
    # 1. Authenticate
    user = db.query(User).filter(User.email == form_data.username).first()
    if not user or not security.verify_password(form_data.password, user.password_hash):
        raise HTTPException(
            status_code=400, 
            detail="Incorrect email or password"
        )
    
    # 2. Create Token
    access_token_expires = timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    return {
        "access_token": security.create_access_token(
            subject=user.id, expires_delta=access_token_expires
        ),
        "token_type": "bearer",
    }

================
File: backend/app/api/endpoints/grocery.py
================
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.api import deps
from app.models.user import User
from app.utils.grocery_logic import generate_grocery_list
from typing import Dict, List

router = APIRouter()

# Schema for the response (A dictionary where Key=Aisle, Value=List of Items)
GroceryListResponse = Dict[str, List[dict]]

@router.get("/", response_model=GroceryListResponse)
def get_grocery_list(
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    """
    Calculate the shopping list based on selected recipes and current inventory.
    """
    return generate_grocery_list(db, current_user.id)

================
File: backend/app/api/endpoints/ingredients.py
================
from typing import List
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.models.ingredient import Ingredient
from pydantic import BaseModel
from uuid import UUID

class IngredientResponse(BaseModel):
    id: UUID
    name: str
    aisle: str
    default_unit: str | None
    
    class Config:
        from_attributes = True

router = APIRouter()

@router.get("/", response_model=List[IngredientResponse])
def read_ingredients(db: Session = Depends(get_db)):
    return db.query(Ingredient).order_by(Ingredient.name).all()

================
File: backend/app/api/endpoints/inventory.py
================
from typing import List
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session, joinedload
from app.db.session import get_db
from app.api import deps
from app.models.inventory import Inventory
from app.models.ingredient import Ingredient
from app.schemas.inventory import InventoryResponse, InventoryUpdate, InventoryCreate
from app.models.user import User

router = APIRouter()

@router.get("/", response_model=List[InventoryResponse])
def read_inventory(
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    items = db.query(Inventory).filter(Inventory.user_id == current_user.id)\
        .options(joinedload(Inventory.ingredient)).all()
    
    return [
        InventoryResponse(
            id=item.id,
            ingredient_id=item.ingredient_id,
            ingredient_name=item.ingredient.name,
            quantity=item.quantity,
            unit=item.unit
        ) for item in items
    ]

@router.post("/", response_model=InventoryResponse)
def add_inventory_item(
    item_in: InventoryCreate,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    # Check if item already exists in inventory
    existing = db.query(Inventory).filter(
        Inventory.user_id == current_user.id,
        Inventory.ingredient_id == item_in.ingredient_id
    ).options(joinedload(Inventory.ingredient)).first()

    if existing:
        existing.quantity = item_in.quantity
        existing.unit = item_in.unit
        db.commit()
        db.refresh(existing)
        return InventoryResponse(
            id=existing.id,
            ingredient_id=existing.ingredient_id,
            ingredient_name=existing.ingredient.name,
            quantity=existing.quantity,
            unit=existing.unit
        )

    # Create new
    new_item = Inventory(
        user_id=current_user.id,
        ingredient_id=item_in.ingredient_id,
        quantity=item_in.quantity,
        unit=item_in.unit
    )
    db.add(new_item)
    db.commit()
    db.refresh(new_item)
    
    # Reload to get ingredient name
    db.refresh(new_item, attribute_names=['ingredient'])
    
    return InventoryResponse(
        id=new_item.id,
        ingredient_id=new_item.ingredient_id,
        ingredient_name=new_item.ingredient.name,
        quantity=new_item.quantity,
        unit=new_item.unit
    )

@router.put("/{inventory_id}", response_model=InventoryResponse)
def update_inventory_item(
    inventory_id: str,
    item_in: InventoryUpdate,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    item = db.query(Inventory).filter(
        Inventory.id == inventory_id,
        Inventory.user_id == current_user.id
    ).options(joinedload(Inventory.ingredient)).first()

    if not item:
        raise HTTPException(status_code=404, detail="Item not found")

    item.quantity = item_in.quantity
    item.unit = item_in.unit
    db.commit()
    db.refresh(item)
    
    return InventoryResponse(
        id=item.id,
        ingredient_id=item.ingredient_id,
        ingredient_name=item.ingredient.name,
        quantity=item.quantity,
        unit=item.unit
    )

================
File: backend/app/api/endpoints/recipes.py
================
from typing import List
from uuid import UUID
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from sqlalchemy.orm import joinedload
from sqlalchemy import func
from pydantic import BaseModel # <--- Ensure BaseModel is imported
from app.utils.suggestion_logic import suggest_recipes # <--- Import this
from app.schemas.recipe import RecipeSuggestion # <--- Import this

from app.db.session import get_db
from app.api import deps
from app.models.recipe import Recipe, RecipeIngredient
from app.models.ingredient import Ingredient
from app.models.user import User
from app.schemas.recipe import RecipeCreate, RecipeResponse, RecipeUpdate

router = APIRouter()

# --- Helper Function to Handle Custom Ingredients ---
def get_or_create_ingredient(db: Session, item) -> UUID:
    if item.ingredient_id:
        return item.ingredient_id

    if item.name:
        existing = db.query(Ingredient).filter(
            func.lower(Ingredient.name) == item.name.lower()
        ).first()
        
        if existing:
            return existing.id
        
        new_ing = Ingredient(
            name=item.name,
            aisle="Other",
            default_unit=item.unit
        )
        db.add(new_ing)
        db.flush()
        return new_ing.id
    
    raise HTTPException(status_code=400, detail="Ingredient must have either an ID or a Name")

# --- Helper Schema for Selection Toggle ---
class RecipeSelect(BaseModel):
    is_selected: bool

@router.get("/", response_model=List[RecipeResponse])
def read_recipes(
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    recipes = db.query(Recipe).filter(Recipe.user_id == current_user.id).options(
        joinedload(Recipe.ingredients).joinedload(RecipeIngredient.ingredient)
    ).all()
    
    results = []
    for r in recipes:
        r_dict = r.__dict__
        
        # --- FIX: Handle None values for existing recipes ---
        if r.is_selected is None:
            r_dict['is_selected'] = False
        # ---------------------------------------------------

        r_dict['ingredients'] = [
            {
                "id": ri.id,
                "ingredient_id": ri.ingredient_id,
                "name": ri.ingredient.name,
                "quantity": ri.quantity,
                "unit": ri.unit
            }
            for ri in r.ingredients
        ]
        results.append(r_dict)
    
    return results


@router.get("/suggestions", response_model=List[RecipeSuggestion])
def get_recipe_suggestions(
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    """
    Compare inventory against recipes and return sorted matches.
    """
    return suggest_recipes(db, current_user.id)


@router.get("/{recipe_id}", response_model=RecipeResponse)
def read_recipe(
    recipe_id: str,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    recipe = db.query(Recipe).filter(
        Recipe.id == recipe_id, 
        Recipe.user_id == current_user.id
    ).options(
        joinedload(Recipe.ingredients).joinedload(RecipeIngredient.ingredient)
    ).first()

    if not recipe:
        raise HTTPException(status_code=404, detail="Recipe not found")
    
    r_dict = recipe.__dict__
    
    # --- FIX: Handle None values for existing recipes ---
    if recipe.is_selected is None:
        r_dict['is_selected'] = False
    # ---------------------------------------------------

    r_dict['ingredients'] = [
        {
            "id": ri.id,
            "ingredient_id": ri.ingredient_id,
            "name": ri.ingredient.name,
            "quantity": ri.quantity,
            "unit": ri.unit
        }
        for ri in recipe.ingredients
    ]
    return r_dict

@router.post("/", response_model=RecipeResponse)
def create_recipe(
    recipe_in: RecipeCreate,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    new_recipe = Recipe(
        title=recipe_in.title,
        instructions=recipe_in.instructions,
        servings=recipe_in.servings,
        user_id=current_user.id
        # is_selected defaults to False in model, so it's safe here
    )
    db.add(new_recipe)
    db.flush() 

    for item in recipe_in.ingredients:
        ing_id = get_or_create_ingredient(db, item)
        recipe_ing = RecipeIngredient(
            recipe_id=new_recipe.id,
            ingredient_id=ing_id,
            quantity=item.quantity,
            unit=item.unit
        )
        db.add(recipe_ing)
    
    db.commit()
    db.refresh(new_recipe)
    return read_recipe(str(new_recipe.id), db, current_user)

@router.put("/{recipe_id}", response_model=RecipeResponse)
def update_recipe(
    recipe_id: str,
    recipe_in: RecipeUpdate,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    recipe = db.query(Recipe).filter(
        Recipe.id == recipe_id, 
        Recipe.user_id == current_user.id
    ).first()

    if not recipe:
        raise HTTPException(status_code=404, detail="Recipe not found")

    recipe.title = recipe_in.title
    recipe.instructions = recipe_in.instructions
    recipe.servings = recipe_in.servings

    db.query(RecipeIngredient).filter(RecipeIngredient.recipe_id == recipe.id).delete()
    
    for item in recipe_in.ingredients:
        ing_id = get_or_create_ingredient(db, item)
        new_ing = RecipeIngredient(
            recipe_id=recipe.id,
            ingredient_id=ing_id,
            quantity=item.quantity,
            unit=item.unit
        )
        db.add(new_ing)
    
    db.commit()
    db.refresh(recipe)
    return read_recipe(str(recipe.id), db, current_user)

@router.patch("/{recipe_id}/select", response_model=RecipeResponse)
def toggle_recipe_selection(
    recipe_id: str,
    selection: RecipeSelect,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    """
    Toggle the 'is_selected' status of a recipe.
    """
    recipe = db.query(Recipe).filter(
        Recipe.id == recipe_id, 
        Recipe.user_id == current_user.id
    ).first()

    if not recipe:
        raise HTTPException(status_code=404, detail="Recipe not found")
    
    recipe.is_selected = selection.is_selected
    db.commit()
    db.refresh(recipe)
    
    return read_recipe(str(recipe.id), db, current_user)

================
File: backend/app/core/config.py
================
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    PROJECT_NAME: str = "Smart Grocery System"
    DATABASE_URL: str
    
    # New Auth Config
    SECRET_KEY: str = "CHANGE_THIS_TO_A_SUPER_SECRET_KEY_IN_PROD" # Generates tokens
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30  # 30 mins for dev (Spec says 15, but 30 is easier for dev)

    class Config:
        env_file = ".env"

settings = Settings()

================
File: backend/app/core/security.py
================
from datetime import datetime, timedelta
from typing import Optional, Any, Union
from jose import jwt
from passlib.context import CryptContext
from app.core.config import settings

# Setup password hashing context (bcrypt)
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """Check if the plain password matches the hashed one."""
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    """Hash a password for storing."""
    return pwd_context.hash(password)

def create_access_token(subject: Union[str, Any], expires_delta: Optional[timedelta] = None) -> str:
    """Generate a JWT token."""
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    
    to_encode = {"exp": expire, "sub": str(subject)}
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

================
File: backend/app/db/base.py
================
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

# Later, import all your models here so Alembic can see them:
# from app.models.user import User
# from app.models.recipe import Recipe
# Import all models here so Alembic can see them
# from app.models.user import User  # <--- Add this line

================
File: backend/app/db/session.py
================
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from app.core.config import settings

# Create engine
# pool_pre_ping=True handles checking if the connection is alive before using it
engine = create_engine(settings.DATABASE_URL, pool_pre_ping=True)

# Create SessionLocal class
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# Dependency for API endpoints
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

================
File: backend/app/main.py
================
from fastapi import FastAPI
from app.core.config import settings
from app.api.endpoints import auth
from fastapi.middleware.cors import CORSMiddleware  # <--- Import this
from app.api.endpoints import auth, recipes, ingredients, inventory, grocery # <--- Import grocery
app = FastAPI(title=settings.PROJECT_NAME)


# --- ADD CORS MIDDLEWARE ---
origins = [
    "http://localhost:3000",  # Next.js frontend
    "http://127.0.0.1:3000",
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Include the Auth Router
# We prefix with /api/v1/auth to match your specs
app.include_router(auth.router, prefix="/api/v1/auth", tags=["auth"])
# --- 2. Include the recipes router ---
app.include_router(recipes.router, prefix="/api/v1/recipes", tags=["recipes"]) 

# --- 3. Include the ingredients router ---
app.include_router(ingredients.router, prefix="/api/v1/ingredients", tags=["ingredients"]) 
# --- 4. Include the inventory router ---
app.include_router(inventory.router, prefix="/api/v1/inventory", tags=["inventory"]) # <--- Add this
# --- 5. Include the grocery router ---
app.include_router(grocery.router, prefix="/api/v1/grocery", tags=["grocery"]) # <--- Add router

@app.get("/")
def root():
    return {"message": "Welcome to the Smart Grocery System API"}

================
File: backend/app/models/ingredient.py
================
import uuid
from sqlalchemy import Column, String
from sqlalchemy.dialects.postgresql import UUID
from app.db.base import Base

class Ingredient(Base):
    __tablename__ = "ingredients"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    name = Column(String, unique=True, nullable=False, index=True)
    aisle = Column(String, nullable=False)  # e.g., "Produce", "Spices"
    default_unit = Column(String, nullable=True)  # e.g., "kg", "jar"

================
File: backend/app/models/inventory.py
================
import uuid
from sqlalchemy import Column, String, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from app.db.base import Base

class Inventory(Base):
    __tablename__ = "inventory"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    ingredient_id = Column(UUID(as_uuid=True), ForeignKey("ingredients.id"), nullable=False)
    
    quantity = Column(String, nullable=False, default="0")
    unit = Column(String, nullable=True)

    # Relationships
    user = relationship("User", back_populates="inventory")
    ingredient = relationship("Ingredient")

================
File: backend/app/models/recipe.py
================
import uuid
from sqlalchemy import Column, String, Integer, ForeignKey, Text, Boolean # <--- Add Boolean
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from app.db.base import Base

class Recipe(Base):
    __tablename__ = "recipes"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    title = Column(String, nullable=False)
    instructions = Column(Text, nullable=True)
    servings = Column(Integer, default=4)
    is_selected = Column(Boolean, default=False) # <--- Add this line
    # Relationships
    user = relationship("User", back_populates="recipes")
    ingredients = relationship("RecipeIngredient", back_populates="recipe", cascade="all, delete-orphan")

class RecipeIngredient(Base):
    __tablename__ = "recipe_ingredients"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    recipe_id = Column(UUID(as_uuid=True), ForeignKey("recipes.id"), nullable=False)
    ingredient_id = Column(UUID(as_uuid=True), ForeignKey("ingredients.id"), nullable=False)
    
    quantity = Column(String, nullable=False) # e.g. "500", "1/2"
    unit = Column(String, nullable=True)      # e.g. "g", "cup"

    # Relationships
    recipe = relationship("Recipe", back_populates="ingredients")
    ingredient = relationship("Ingredient")

================
File: backend/app/models/user.py
================
import uuid
from datetime import datetime
from sqlalchemy import Column, String, DateTime
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship

from app.db.base import Base

class User(Base):
    __tablename__ = "users"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    email = Column(String(255), unique=True, nullable=False, index=True)
    password_hash = Column(String(255), nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    recipes = relationship("Recipe", back_populates="user", cascade="all, delete-orphan")
    inventory = relationship("Inventory", back_populates="user", cascade="all, delete-orphan")
    # Relationships (We will uncomment these later when we create the other models)
    # recipes = relationship("Recipe", back_populates="user", cascade="all, delete-orphan")
    # inventory = relationship("Inventory", back_populates="user", cascade="all, delete-orphan")

================
File: backend/app/schemas/inventory.py
================
from pydantic import BaseModel
from uuid import UUID
from typing import Optional

class InventoryBase(BaseModel):
    quantity: str
    unit: Optional[str] = None

class InventoryUpdate(InventoryBase):
    pass

class InventoryCreate(InventoryBase):
    ingredient_id: UUID

class InventoryResponse(InventoryBase):
    id: UUID
    ingredient_id: UUID
    ingredient_name: str # Mapped from relation

    class Config:
        from_attributes = True

================
File: backend/app/schemas/recipe.py
================
from pydantic import BaseModel
from typing import List, Optional
from uuid import UUID

# --- Nested Schemas ---

# Base schema for shared fields
class RecipeIngredientBase(BaseModel):
    quantity: str
    unit: Optional[str] = None

# INPUT schema: Now accepts EITHER ingredient_id OR name
class RecipeIngredientCreate(RecipeIngredientBase):
    ingredient_id: Optional[UUID] = None
    name: Optional[str] = None 

class RecipeIngredientResponse(RecipeIngredientBase):
    id: UUID
    ingredient_id: UUID
    name: str 

    class Config:
        from_attributes = True

# --- Recipe Schemas ---

class RecipeBase(BaseModel):
    title: str
    instructions: Optional[str] = None
    servings: int = 4
    is_selected: bool = False # <--- Add this

class RecipeCreate(RecipeBase):
    ingredients: List[RecipeIngredientCreate] = []

class RecipeUpdate(RecipeBase):
    ingredients: List[RecipeIngredientCreate] = []

class RecipeResponse(RecipeBase):
    id: UUID
    ingredients: List[RecipeIngredientResponse] = []
    is_selected: bool # <--- Add this
    
    class Config:
        from_attributes = True

class MissingIngredient(BaseModel):
    name: str
    missing_qty: str
    unit: str

class RecipeSuggestion(BaseModel):
    id: UUID
    title: str
    servings: int
    match_percentage: int
    missing_ingredients: List[MissingIngredient]

================
File: backend/app/schemas/token.py
================
from pydantic import BaseModel
from typing import Optional

class Token(BaseModel):
    access_token: str
    token_type: str

class TokenData(BaseModel):
    id: Optional[str] = None

================
File: backend/app/schemas/user.py
================
from pydantic import BaseModel, EmailStr
from uuid import UUID
from datetime import datetime

# Shared properties
class UserBase(BaseModel):
    email: EmailStr

# Properties to receive via API on creation
class UserCreate(UserBase):
    password: str

# Properties to return via API
class UserResponse(UserBase):
    id: UUID
    created_at: datetime

    class Config:
        from_attributes = True  # Allows Pydantic to read data from SQLAlchemy models

================
File: backend/app/seed_ingredients.py
================
import logging
from app.db.session import SessionLocal
from app.models.ingredient import Ingredient

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

COMMON_INGREDIENTS = [
    # Produce
    {"name": "Onion", "aisle": "Produce", "default_unit": "whole"},
    {"name": "Garlic", "aisle": "Produce", "default_unit": "clove"},
    {"name": "Tomato", "aisle": "Produce", "default_unit": "whole"},
    {"name": "Potato", "aisle": "Produce", "default_unit": "kg"},
    {"name": "Carrot", "aisle": "Produce", "default_unit": "whole"},
    {"name": "Spinach", "aisle": "Produce", "default_unit": "bunch"},
    
    # Meat
    {"name": "Chicken Breast", "aisle": "Meat", "default_unit": "kg"},
    {"name": "Ground Beef", "aisle": "Meat", "default_unit": "kg"},
    {"name": "Bacon", "aisle": "Meat", "default_unit": "pack"},
    
    # Dairy
    {"name": "Milk", "aisle": "Dairy", "default_unit": "L"},
    {"name": "Butter", "aisle": "Dairy", "default_unit": "block"},
    {"name": "Cheddar Cheese", "aisle": "Dairy", "default_unit": "block"},
    {"name": "Eggs", "aisle": "Dairy", "default_unit": "dozen"},
    
    # Pantry
    {"name": "Olive Oil", "aisle": "Oil & Vinegars", "default_unit": "L"},
    {"name": "Salt", "aisle": "Spices", "default_unit": "g"},
    {"name": "Black Pepper", "aisle": "Spices", "default_unit": "g"},
    {"name": "Rice", "aisle": "Grains", "default_unit": "kg"},
    {"name": "Pasta", "aisle": "Grains", "default_unit": "box"},
    {"name": "Flour", "aisle": "Baking", "default_unit": "kg"},
    {"name": "Sugar", "aisle": "Baking", "default_unit": "kg"},
]

def seed_ingredients():
    db = SessionLocal()
    try:
        logger.info("Starting ingredient seed...")
        count = 0
        for data in COMMON_INGREDIENTS:
            # Check if exists
            exists = db.query(Ingredient).filter(Ingredient.name == data["name"]).first()
            if not exists:
                ingredient = Ingredient(**data)
                db.add(ingredient)
                count += 1
        
        db.commit()
        logger.info(f"Successfully added {count} new ingredients.")
    except Exception as e:
        logger.error(f"Error seeding data: {e}")
        db.rollback()
    finally:
        db.close()

if __name__ == "__main__":
    seed_ingredients()

================
File: backend/app/utils/grocery_logic.py
================
from sqlalchemy.orm import Session
from typing import Dict, List
from app.models.recipe import Recipe
from app.models.inventory import Inventory
from app.models.ingredient import Ingredient
from uuid import UUID

def parse_quantity(qty_str: str) -> float:
    """
    Converts strings like '1.5', '1/2', '2' into floats.
    Returns 0.0 if parsing fails.
    """
    if not qty_str:
        return 0.0
    try:
        if '/' in qty_str:
            num, den = qty_str.split('/')
            return float(num) / float(den)
        return float(qty_str)
    except ValueError:
        return 0.0

def generate_grocery_list(db: Session, user_id: UUID) -> Dict[str, List[dict]]:
    """
    1. Aggregates ingredients from selected recipes.
    2. Subtracts inventory.
    3. Groups by Aisle.
    """
    
    # --- 1. Fetch Selected Recipes ---
    selected_recipes = db.query(Recipe).filter(
        Recipe.user_id == user_id, 
        Recipe.is_selected == True
    ).all()

    # Dictionary Key: (ingredient_id, unit) -> Value: { 'qty': float, 'obj': Ingredient }
    # We group by Unit as well because we can't subtract 'grams' from 'cups' easily in MVP
    needed_map = {}

    for recipe in selected_recipes:
        for r_ing in recipe.ingredients:
            key = (r_ing.ingredient_id, r_ing.unit)
            qty_val = parse_quantity(r_ing.quantity)

            if key not in needed_map:
                needed_map[key] = {
                    'qty': 0.0,
                    'ingredient': r_ing.ingredient
                }
            
            needed_map[key]['qty'] += qty_val

    # --- 2. Fetch Inventory & Subtract ---
    user_inventory = db.query(Inventory).filter(Inventory.user_id == user_id).all()

    for item in user_inventory:
        qty_val = parse_quantity(item.quantity)
        key = (item.ingredient_id, item.unit)

        # Only subtract if we actually need this item (and units match)
        if key in needed_map:
            needed_map[key]['qty'] -= qty_val

    # --- 3. Format & Group by Aisle ---
    final_list = {}

    for (ing_id, unit), data in needed_map.items():
        remaining_qty = data['qty']
        ingredient = data['ingredient']

        # If we still need it (greater than generic "epsilon" to handle float errors)
        if remaining_qty > 0.01:
            aisle = ingredient.aisle or "Other"
            
            if aisle not in final_list:
                final_list[aisle] = []

            # Format quantity back to pretty string if it's an integer
            display_qty = f"{remaining_qty:.2f}".rstrip('0').rstrip('.')
            
            final_list[aisle].append({
                "name": ingredient.name,
                "quantity": display_qty,
                "unit": unit or ""
            })

    return final_list

================
File: backend/app/utils/suggestion_logic.py
================
from sqlalchemy.orm import Session
from typing import List, Dict, Any
from app.models.recipe import Recipe
from app.models.inventory import Inventory
from app.utils.grocery_logic import parse_quantity # Re-use our helper

def suggest_recipes(db: Session, user_id: str) -> List[Dict[str, Any]]:
    """
    Returns a list of recipes sorted by how many ingredients the user currently has.
    """
    
    # 1. Fetch all Recipes and Inventory
    recipes = db.query(Recipe).filter(Recipe.user_id == user_id).all()
    inventory = db.query(Inventory).filter(Inventory.user_id == user_id).all()

    # 2. Build Inventory Lookup Map
    # Key: (ingredient_id, unit) -> Value: Total Quantity
    inventory_map = {}
    for item in inventory:
        key = (item.ingredient_id, item.unit)
        qty = parse_quantity(item.quantity)
        
        if key not in inventory_map:
            inventory_map[key] = 0.0
        inventory_map[key] += qty

    results = []

    # 3. Analyze Each Recipe
    for recipe in recipes:
        total_ingredients = len(recipe.ingredients)
        if total_ingredients == 0:
            continue

        missing_ingredients = []
        matches = 0

        for r_ing in recipe.ingredients:
            required_qty = parse_quantity(r_ing.quantity)
            key = (r_ing.ingredient_id, r_ing.unit)

            # Check if we have it
            if key in inventory_map:
                owned_qty = inventory_map[key]
                
                if owned_qty >= required_qty:
                    # Full match: We have enough
                    matches += 1
                else:
                    # Partial match: We have some, but not enough
                    missing_amount = required_qty - owned_qty
                    missing_ingredients.append({
                        "name": r_ing.ingredient.name,
                        "missing_qty": f"{missing_amount:.2f}".rstrip('0').rstrip('.'),
                        "unit": r_ing.unit
                    })
            else:
                # No match: We don't have this ingredient (or unit mismatch)
                missing_ingredients.append({
                    "name": r_ing.ingredient.name,
                    "missing_qty": r_ing.quantity,
                    "unit": r_ing.unit
                })

        # Calculate Score
        match_percentage = int((matches / total_ingredients) * 100)

        results.append({
            "id": recipe.id,
            "title": recipe.title,
            "servings": recipe.servings,
            "match_percentage": match_percentage,
            "missing_ingredients": missing_ingredients
        })

    # 4. Sort by Match Percentage (Highest First)
    results.sort(key=lambda x: x['match_percentage'], reverse=True)
    
    return results

================
File: backend/requirements.txt
================
fastapi
uvicorn[standard]
sqlalchemy
alembic
psycopg2-binary
python-dotenv
pydantic
pydantic-settings
passlib[bcrypt]
python-jose[cryptography]
python-multipart
email-validator 
bcrypt==4.0.1

================
File: docker-compose.yml
================
version: '3.8'

services:
  db:
    image: postgres:15-alpine
    container_name: grocery_db
    restart: always
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=grocery_app
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:

================
File: web/.gitignore
================
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

================
File: web/eslint.config.mjs
================
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

================
File: web/next.config.ts
================
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;

================
File: web/package.json
================
{
  "name": "web",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@tanstack/react-query": "^5.90.12",
    "axios": "^1.13.2",
    "js-cookie": "^3.0.5",
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/js-cookie": "^3.0.6",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

================
File: web/postcss.config.mjs
================
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;

================
File: web/public/file.svg
================
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>

================
File: web/public/globe.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>

================
File: web/public/next.svg
================
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>

================
File: web/public/vercel.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>

================
File: web/public/window.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>

================
File: web/README.md
================
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

================
File: web/repomix-output.txt
================
This file is a merged representation of the entire codebase, combined into a single document.
Generated by Repomix on: 2025-12-24T22:31:54.716Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded

Additional Info:
----------------

================================================================
Directory Structure
================================================================
.gitignore
eslint.config.mjs
next.config.ts
package.json
postcss.config.mjs
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
README.md
src/app/globals.css
src/app/layout.tsx
src/app/page.tsx
tsconfig.json

================================================================
Files
================================================================

================
File: .gitignore
================
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

================
File: eslint.config.mjs
================
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

================
File: next.config.ts
================
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;

================
File: package.json
================
{
  "name": "web",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "axios": "^1.13.2",
    "js-cookie": "^3.0.5",
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/js-cookie": "^3.0.6",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

================
File: postcss.config.mjs
================
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;

================
File: public/file.svg
================
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>

================
File: public/globe.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>

================
File: public/next.svg
================
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>

================
File: public/vercel.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>

================
File: public/window.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>

================
File: README.md
================
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

================
File: src/app/globals.css
================
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}

================
File: src/app/layout.tsx
================
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}

================
File: src/app/page.tsx
================
import Image from "next/image";

export default function Home() {
  return (
    <div className="flex min-h-screen items-center justify-center bg-zinc-50 font-sans dark:bg-black">
      <main className="flex min-h-screen w-full max-w-3xl flex-col items-center justify-between py-32 px-16 bg-white dark:bg-black sm:items-start">
        <Image
          className="dark:invert"
          src="/next.svg"
          alt="Next.js logo"
          width={100}
          height={20}
          priority
        />
        <div className="flex flex-col items-center gap-6 text-center sm:items-start sm:text-left">
          <h1 className="max-w-xs text-3xl font-semibold leading-10 tracking-tight text-black dark:text-zinc-50">
            To get started, edit the page.tsx file.
          </h1>
          <p className="max-w-md text-lg leading-8 text-zinc-600 dark:text-zinc-400">
            Looking for a starting point or more instructions? Head over to{" "}
            <a
              href="https://vercel.com/templates?framework=next.js&utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app"
              className="font-medium text-zinc-950 dark:text-zinc-50"
            >
              Templates
            </a>{" "}
            or the{" "}
            <a
              href="https://nextjs.org/learn?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app"
              className="font-medium text-zinc-950 dark:text-zinc-50"
            >
              Learning
            </a>{" "}
            center.
          </p>
        </div>
        <div className="flex flex-col gap-4 text-base font-medium sm:flex-row">
          <a
            className="flex h-12 w-full items-center justify-center gap-2 rounded-full bg-foreground px-5 text-background transition-colors hover:bg-[#383838] dark:hover:bg-[#ccc] md:w-[158px]"
            href="https://vercel.com/new?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app"
            target="_blank"
            rel="noopener noreferrer"
          >
            <Image
              className="dark:invert"
              src="/vercel.svg"
              alt="Vercel logomark"
              width={16}
              height={16}
            />
            Deploy Now
          </a>
          <a
            className="flex h-12 w-full items-center justify-center rounded-full border border-solid border-black/[.08] px-5 transition-colors hover:border-transparent hover:bg-black/[.04] dark:border-white/[.145] dark:hover:bg-[#1a1a1a] md:w-[158px]"
            href="https://nextjs.org/docs?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app"
            target="_blank"
            rel="noopener noreferrer"
          >
            Documentation
          </a>
        </div>
      </main>
    </div>
  );
}

================
File: tsconfig.json
================
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}



================================================================
End of Codebase
================================================================

================
File: web/src/app/[id]/page.tsx
================
'use client';

import { useQuery } from '@tanstack/react-query';
import api from '@/lib/api';
import Link from 'next/link';
import { useParams } from 'next/navigation';
import { useAuth } from '@/context/AuthContext';

interface Ingredient {
  name: string;
  quantity: string;
  unit: string;
}

interface Recipe {
  id: string;
  title: string;
  servings: number;
  instructions: string;
  ingredients: Ingredient[];
}

export default function RecipeDetailPage() {
  const { id } = useParams();
  const { user } = useAuth();

  const { data: recipe, isLoading, error } = useQuery<Recipe>({
    queryKey: ['recipe', id],
    queryFn: async () => (await api.get(`/recipes/${id}`)).data,
    enabled: !!user && !!id
  });

  if (isLoading) return <div className="p-8 text-center text-gray-500">Loading recipe...</div>;
  if (error || !recipe) return <div className="p-8 text-center text-red-500">Recipe not found</div>;

  return (
    <div className="min-h-screen bg-gray-50 p-8 text-black">
      <div className="max-w-3xl mx-auto bg-white rounded-lg shadow overflow-hidden">
        {/* Header */}
        <div className="bg-blue-600 px-8 py-6 text-white flex justify-between items-center">
            <div>
                <h1 className="text-3xl font-bold">{recipe.title}</h1>
                <p className="opacity-90 mt-1">Serves {recipe.servings}</p>
            </div>
            <Link 
                href="/" 
                className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded transition text-sm font-medium"
            >
                &larr; Back
            </Link>
        </div>

        <div className="p-8 grid md:grid-cols-3 gap-8">
            {/* Ingredients Sidebar */}
            <div className="md:col-span-1 bg-gray-50 p-6 rounded-lg border border-gray-100 h-fit">
                <h2 className="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Ingredients</h2>
                <ul className="space-y-3 text-sm text-gray-700">
                    {recipe.ingredients.map((ing, idx) => (
                        <li key={idx} className="flex justify-between">
                            <span>{ing.name}</span>
                            <span className="font-semibold text-gray-500">{ing.quantity} {ing.unit}</span>
                        </li>
                    ))}
                </ul>
            </div>

            {/* Instructions Main Area */}
            <div className="md:col-span-2">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Instructions</h2>
                <div className="prose prose-blue text-gray-700 whitespace-pre-line leading-relaxed">
                    {recipe.instructions || "No instructions provided."}
                </div>
            </div>
        </div>
      </div>
    </div>
  );
}

================
File: web/src/app/globals.css
================
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}

================
File: web/src/app/grocery-list/page.tsx
================
'use client';

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import api from '@/lib/api';
import Link from 'next/link';
import { useAuth } from '@/context/AuthContext';

// --- Interfaces ---
interface GroceryItem {
  name: string;
  quantity: string;
  unit: string;
}

interface Recipe {
  id: string;
  title: string;
  is_selected: boolean;
}

type GroceryListResponse = Record<string, GroceryItem[]>;

export default function GroceryListPage() {
  const { user } = useAuth();
  const queryClient = useQueryClient();

  // 1. Fetch Selected Recipes (for the Sidebar)
  const { data: recipes } = useQuery<Recipe[]>({
    queryKey: ['recipes'],
    queryFn: async () => (await api.get('/recipes')).data,
    enabled: !!user
  });

  // 2. Fetch Grocery List (Computed)
  const { data: groceryList, isLoading: isListLoading } = useQuery<GroceryListResponse>({
    queryKey: ['grocery-list'],
    queryFn: async () => (await api.get('/grocery')).data,
    enabled: !!user
  });

  // 3. Mutation: Toggle Recipe
  const toggleMutation = useMutation({
    mutationFn: async ({ id, is_selected }: { id: string; is_selected: boolean }) => {
      return api.patch(`/recipes/${id}/select`, { is_selected });
    },
    onMutate: async ({ id, is_selected }) => {
      // Optimistic Update for Recipe List
      await queryClient.cancelQueries({ queryKey: ['recipes'] });
      const prevRecipes = queryClient.getQueryData<Recipe[]>(['recipes']);
      
      queryClient.setQueryData<Recipe[]>(['recipes'], (old) => 
        old?.map(r => r.id === id ? { ...r, is_selected } : r)
      );

      return { prevRecipes };
    },
    onSettled: () => {
      // CRITICAL: Invalidate BOTH to force the list to recalculate!
      queryClient.invalidateQueries({ queryKey: ['recipes'] });
      queryClient.invalidateQueries({ queryKey: ['grocery-list'] });
    }
  });

  // Filter only selected recipes for the "Active Menu" count
  const activeCount = recipes?.filter(r => r.is_selected).length || 0;
  const isEmpty = !groceryList || Object.keys(groceryList).length === 0;

  if (!user) return null;

  return (
    <div className="min-h-screen bg-gray-50 text-black flex flex-col md:flex-row">
      
      {/* --- LEFT SIDEBAR: RECIPE CONTROL --- */}
      <aside className="w-full md:w-1/3 lg:w-1/4 bg-white border-r min-h-[200px] md:min-h-screen p-6">
        <div className="mb-6">
          <Link href="/" className="text-sm text-gray-500 hover:text-gray-900 mb-4 inline-block">
             Back to Dashboard
          </Link>
          <h2 className="text-xl font-bold text-gray-800">Menu</h2>
          <p className="text-sm text-gray-500">{activeCount} recipes selected</p>
        </div>

        <div className="space-y-3">
          {recipes?.map(recipe => (
            <label 
              key={recipe.id} 
              className={`flex items-center space-x-3 p-3 rounded cursor-pointer transition ${
                recipe.is_selected ? 'bg-green-50 border border-green-200' : 'hover:bg-gray-50 border border-transparent'
              }`}
            >
              <input 
                type="checkbox"
                checked={recipe.is_selected}
                onChange={(e) => toggleMutation.mutate({ 
                  id: recipe.id, 
                  is_selected: e.target.checked 
                })}
                className="w-5 h-5 text-green-600 rounded focus:ring-green-500 border-gray-300"
              />
              <span className={`text-sm font-medium ${recipe.is_selected ? 'text-green-800' : 'text-gray-600'}`}>
                {recipe.title}
              </span>
            </label>
          ))}
        </div>
      </aside>

      {/* --- RIGHT SIDE: SHOPPING LIST --- */}
      <main className="flex-1 p-8">
        <header className="flex justify-between items-center mb-8">
          <h1 className="text-3xl font-bold text-gray-800">Shopping List</h1>
          {isListLoading && <span className="text-sm text-gray-400 animate-pulse">Updating...</span>}
        </header>

        {isEmpty ? (
          <div className="text-center py-20 bg-white rounded-lg shadow-sm border border-dashed border-gray-300">
            <p className="text-xl text-gray-400 mb-2">Your list is empty.</p>
            <p className="text-gray-500 text-sm">Select recipes on the left to generate a list.</p>
          </div>
        ) : (
          <div className="masonry-grid grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* Render Aisles */}
            {groceryList && Object.entries(groceryList).map(([aisle, items]) => (
              <div key={aisle} className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden self-start">
                <div className="bg-gray-100 px-4 py-2 border-b border-gray-200 flex justify-between items-center">
                  <h3 className="font-bold text-gray-700">{aisle}</h3>
                  <span className="text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full">{items.length}</span>
                </div>
                <ul className="divide-y divide-gray-100">
                  {items.map((item, idx) => (
                    <li key={idx} className="px-4 py-3 flex justify-between items-center hover:bg-gray-50 group">
                      <div className="flex items-center">
                        <input type="checkbox" className="mr-3 h-4 w-4 text-blue-600 rounded border-gray-300 opacity-50 hover:opacity-100" />
                        <span className="font-medium text-gray-800 group-hover:text-black">{item.name}</span>
                      </div>
                      <span className="text-sm font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded">
                        {item.quantity} {item.unit}
                      </span>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        )}
      </main>
    </div>
  );
}

================
File: web/src/app/inventory/page.tsx
================
'use client';

import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import api from '@/lib/api';
import Link from 'next/link';

interface InventoryItem {
  id: string;
  ingredient_id: string;
  ingredient_name: string;
  quantity: string;
  unit: string;
}

interface IngredientOption {
  id: string;
  name: string;
  default_unit: string;
}

export default function InventoryPage() {
  const queryClient = useQueryClient();
  const [newItemId, setNewItemId] = useState('');

  // 1. Fetch Inventory
  const { data: inventory, isLoading } = useQuery<InventoryItem[]>({
    queryKey: ['inventory'],
    queryFn: async () => (await api.get('/inventory')).data
  });

  // 2. Fetch Ingredients (for the 'Add' dropdown)
  const { data: ingredients } = useQuery<IngredientOption[]>({
    queryKey: ['ingredients'],
    queryFn: async () => (await api.get('/ingredients')).data
  });

  // 3. Mutation: Update Quantity
  const updateMutation = useMutation({
    mutationFn: async ({ id, quantity, unit }: { id: string; quantity: string; unit: string }) => {
      return api.put(`/inventory/${id}`, { quantity, unit });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['inventory'] });
    }
  });

  // 4. Mutation: Add New Item
  const addMutation = useMutation({
    mutationFn: async (ingredient_id: string) => {
      // Find default unit
      const ing = ingredients?.find(i => i.id === ingredient_id);
      return api.post('/inventory', { 
        ingredient_id, 
        quantity: "1", 
        unit: ing?.default_unit || "unit" 
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['inventory'] });
      setNewItemId('');
    }
  });

  if (isLoading) return <div className="p-8">Loading inventory...</div>;

  return (
    <div className="min-h-screen bg-gray-50 p-8 text-black">
      <div className="max-w-4xl mx-auto">
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-3xl font-bold">My Kitchen Inventory</h1>
          <Link href="/" className="text-blue-600 hover:underline">Back to Recipes</Link>
        </div>

        {/* Add New Item Section */}
        <div className="bg-white p-4 rounded shadow mb-8 flex gap-4">
          <select 
            className="flex-grow border rounded px-3 py-2 bg-white"
            value={newItemId}
            onChange={(e) => setNewItemId(e.target.value)}
          >
            <option value="">Select an ingredient to add...</option>
            {ingredients?.map(ing => (
              <option key={ing.id} value={ing.id}>{ing.name}</option>
            ))}
          </select>
          <button 
            disabled={!newItemId}
            onClick={() => addMutation.mutate(newItemId)}
            className="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 disabled:opacity-50"
          >
            Add
          </button>
        </div>

        {/* Inventory Table */}
        <div className="bg-white rounded shadow overflow-hidden">
          <table className="w-full">
            <thead className="bg-gray-100 border-b">
              <tr>
                <th className="text-left py-3 px-4 font-semibold text-gray-600">Ingredient</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-600 w-32">Quantity</th>
                <th className="text-left py-3 px-4 font-semibold text-gray-600 w-24">Unit</th>
                <th className="py-3 px-4"></th>
              </tr>
            </thead>
            <tbody>
              {inventory?.length === 0 && (
                <tr>
                  <td colSpan={4} className="text-center py-8 text-gray-500">Your fridge is empty!</td>
                </tr>
              )}
              {inventory?.map((item) => (
                <tr key={item.id} className="border-b last:border-0 hover:bg-gray-50">
                  <td className="py-3 px-4 font-medium">{item.ingredient_name}</td>
                  
                  {/* Editable Quantity */}
                  <td className="py-3 px-4">
                    <input 
                      type="text" 
                      className="border rounded px-2 py-1 w-full text-center focus:ring-2 focus:ring-blue-500 outline-none"
                      defaultValue={item.quantity}
                      onBlur={(e) => {
                        // Only save if value changed
                        if (e.target.value !== item.quantity) {
                          updateMutation.mutate({ 
                            id: item.id, 
                            quantity: e.target.value, 
                            unit: item.unit 
                          });
                        }
                      }}
                      onKeyDown={(e) => {
                        if (e.key === 'Enter') e.currentTarget.blur();
                      }}
                    />
                  </td>

                  {/* Editable Unit */}
                  <td className="py-3 px-4">
                     <input 
                      type="text" 
                      className="border rounded px-2 py-1 w-full text-center focus:ring-2 focus:ring-blue-500 outline-none"
                      defaultValue={item.unit}
                      onBlur={(e) => {
                        if (e.target.value !== item.unit) {
                          updateMutation.mutate({ 
                            id: item.id, 
                            quantity: item.quantity, 
                            unit: e.target.value 
                          });
                        }
                      }}
                      onKeyDown={(e) => {
                         if (e.key === 'Enter') e.currentTarget.blur();
                      }}
                    />
                  </td>
                  
                  <td className="py-3 px-4 text-xs text-gray-400">
                    {updateMutation.isPending && "Saving..."}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

================
File: web/src/app/layout.tsx
================
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { AuthProvider } from "@/context/AuthContext";
import Providers from "@/lib/providers"; // <--- Import TanStack Query Provider

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Smart Grocery System",
  description: "Automated grocery lists",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {/* Wrap everything in Providers first, then AuthProvider */}
        <Providers>
          <AuthProvider>
            {children}
          </AuthProvider>
        </Providers>
      </body>
    </html>
  );
}

================
File: web/src/app/login/page.tsx
================
'use client';

import { useState } from 'react';
import { useAuth } from '@/context/AuthContext';
import api from '@/lib/api';
import Link from 'next/link';

export default function LoginPage() {
  const { login } = useAuth();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    
    try {
      // FastAPI expects form-data for OAuth2 login
      const formData = new FormData();
      formData.append('username', email);
      formData.append('password', password);

      const res = await api.post('/auth/login', formData, {
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
      });
      
      login(res.data.access_token, email);
    } catch (err: any) {
      console.error(err);
      setError('Invalid email or password');
    }
  };

  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-100">
      <div className="w-full max-w-md p-8 space-y-6 bg-white rounded shadow-md text-black">
        <h2 className="text-2xl font-bold text-center">Login</h2>
        {error && <p className="text-red-500 text-center">{error}</p>}
        
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700">Email</label>
            <input 
              type="email" 
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              required 
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Password</label>
            <input 
              type="password" 
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              required 
            />
          </div>
          <button 
            type="submit" 
            className="w-full py-2 text-white bg-blue-600 rounded hover:bg-blue-700"
          >
            Sign In
          </button>
        </form>
        <p className="text-center text-sm text-gray-600">
          Don't have an account? <Link href="/register" className="text-blue-500 hover:underline">Register</Link>
        </p>
      </div>
    </div>
  );
}

================
File: web/src/app/page.tsx
================
'use client';

import api from '@/lib/api';
import Link from 'next/link';
import { useAuth } from '@/context/AuthContext';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';

interface Ingredient {
  name: string;
  quantity: string;
  unit: string;
}

interface Recipe {
  id: string;
  title: string;
  servings: number;
  ingredients: Ingredient[];
  is_selected: boolean;
}

export default function Dashboard() {
  const { user, logout } = useAuth();
  const queryClient = useQueryClient();

  const { data: recipes, isLoading } = useQuery<Recipe[]>({
    queryKey: ['recipes'],
    queryFn: async () => (await api.get('/recipes')).data,
    enabled: !!user 
  });

  const toggleMutation = useMutation({
    mutationFn: async ({ id, is_selected }: { id: string; is_selected: boolean }) => {
      return api.patch(`/recipes/${id}/select`, { is_selected });
    },
    onMutate: async ({ id, is_selected }) => {
      await queryClient.cancelQueries({ queryKey: ['recipes'] });
      const previousRecipes = queryClient.getQueryData<Recipe[]>(['recipes']);
      queryClient.setQueryData<Recipe[]>(['recipes'], (old) => {
        if (!old) return [];
        return old.map((recipe) =>
          recipe.id === id ? { ...recipe, is_selected } : recipe
        );
      });
      return { previousRecipes };
    },
    onError: (err, newTodo, context) => {
      queryClient.setQueryData(['recipes'], context?.previousRecipes);
    },
    onSettled: () => {
      queryClient.invalidateQueries({ queryKey: ['recipes'] });
    },
  });

  if (!user) return null;

  return (
    <div className="min-h-screen bg-gray-50 p-8 text-black">
      <header className="flex flex-col xl:flex-row justify-between items-center mb-8 gap-4">
        <h1 className="text-3xl font-bold text-gray-800">My Recipes</h1>
        
        <div className="flex flex-wrap items-center gap-4 justify-center">
          <Link 
            href="/what-can-i-cook" 
            className="bg-purple-600 text-white px-5 py-2 rounded-full font-semibold shadow hover:bg-purple-700 transition flex items-center gap-2"
          >
             What Can I Cook?
          </Link>

          <Link 
            href="/grocery-list" 
            className="bg-blue-600 text-white px-5 py-2 rounded-full font-semibold shadow hover:bg-blue-700 transition flex items-center gap-2"
          >
             View Shopping List
          </Link>

          <Link 
            href="/inventory" 
            className="text-gray-600 font-medium hover:text-gray-900 hover:underline px-2"
          >
            My Fridge
          </Link>
          <Link 
            href="/recipes/new" 
            className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition"
          >
            + Add Recipe
          </Link>
          <button 
            onClick={logout} 
            className="text-red-500 hover:text-red-700 font-medium ml-2"
          >
            Logout
          </button>
        </div>
      </header>

      {isLoading ? (
        <p className="text-center text-gray-500">Loading your recipes...</p>
      ) : recipes?.length === 0 ? (
        <div className="text-center py-20 bg-white rounded-lg shadow">
          <p className="text-xl text-gray-600 mb-4">You haven't added any recipes yet.</p>
          <Link href="/recipes/new" className="text-blue-500 hover:underline">Create your first one now!</Link>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {recipes?.map((recipe) => (
            <div 
              key={recipe.id} 
              className={`relative rounded-lg shadow transition border-2 group hover:shadow-lg ${
                recipe.is_selected ? 'bg-green-50 border-green-500' : 'bg-white border-transparent'
              }`}
            >
              {/* 1. The Checkbox Area 
                 Positioned absolutely so it sits on top of the card but is separate from the Link.
                 z-10 ensures it catches clicks before the link does.
              */}
              <div className="absolute top-4 right-4 z-10 bg-white/50 p-1 rounded backdrop-blur-sm hover:bg-white transition">
                <label className="flex items-center gap-2 cursor-pointer select-none">
                  <span className="text-xs font-bold text-gray-600 uppercase tracking-wide">
                    {recipe.is_selected ? 'Cook' : 'Select'}
                  </span>
                  <input 
                    type="checkbox"
                    checked={recipe.is_selected}
                    onChange={(e) => toggleMutation.mutate({ 
                      id: recipe.id, 
                      is_selected: e.target.checked 
                    })}
                    className="w-5 h-5 text-green-600 rounded focus:ring-green-500 border-gray-300 shadow-sm"
                  />
                </label>
              </div>

              {/* 2. The Clickable Card Body 
                 Everything here links to the detail page.
              */}
              <Link href={`/recipes/${recipe.id}`} className="block p-6 h-full">
                <div className="pr-16"> {/* Padding right to avoid overlap with checkbox */}
                  <h2 className="text-xl font-bold text-gray-800 mb-1 group-hover:text-blue-600 transition-colors">
                    {recipe.title}
                  </h2>
                  <p className="text-sm text-gray-500 mb-4">Serves: {recipe.servings}</p>
                </div>
                
                <ul className="text-sm space-y-1 mt-4 text-gray-600">
                  {recipe.ingredients.slice(0, 3).map((ing, idx) => (
                    <li key={idx} className="truncate">
                       {ing.quantity} {ing.unit} {ing.name}
                    </li>
                  ))}
                  {recipe.ingredients.length > 3 && (
                    <li className="text-gray-400 text-xs italic">+ {recipe.ingredients.length - 3} more</li>
                  )}
                </ul>
              </Link>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

================
File: web/src/app/recipes/new/page.tsx
================
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import api from '@/lib/api';
import Link from 'next/link';

interface IngredientOption {
  id: string;
  name: string;
  default_unit: string;
}

interface IngredientRow {
  ingredient_id: string; // If selecting existing
  custom_name: string;   // If typing new
  quantity: string;
  unit: string;
  isCustom: boolean;     // Toggle state
}

export default function NewRecipePage() {
  const router = useRouter();
  
  // Form State
  const [title, setTitle] = useState('');
  const [instructions, setInstructions] = useState('');
  const [servings, setServings] = useState(4);
  const [rows, setRows] = useState<IngredientRow[]>([]);
  
  // Data State
  const [availableIngredients, setAvailableIngredients] = useState<IngredientOption[]>([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    api.get('/ingredients')
      .then(res => setAvailableIngredients(res.data))
      .catch(err => console.error("Failed to load ingredients", err));
  }, []);

  const addRow = () => {
    setRows([...rows, { ingredient_id: '', custom_name: '', quantity: '', unit: '', isCustom: false }]);
  };

  const removeRow = (index: number) => {
    const newRows = [...rows];
    newRows.splice(index, 1);
    setRows(newRows);
  };

  const updateRow = (index: number, field: keyof IngredientRow, value: any) => {
    const newRows = [...rows];
    // @ts-ignore
    newRows[index][field] = value;

    // Auto-fill unit if selecting existing ingredient
    if (field === 'ingredient_id' && !newRows[index].isCustom) {
      const selected = availableIngredients.find(i => i.id === value);
      if (selected && selected.default_unit) {
        newRows[index].unit = selected.default_unit;
      }
    }
    setRows(newRows);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    // Transform rows for API
    const apiIngredients = rows.map(r => {
      if (r.isCustom) {
        return { name: r.custom_name, quantity: r.quantity, unit: r.unit };
      } else {
        return { ingredient_id: r.ingredient_id, quantity: r.quantity, unit: r.unit };
      }
    }).filter(r => (r.ingredient_id || r.name) && r.quantity);

    try {
      await api.post('/recipes', {
        title,
        instructions,
        servings,
        ingredients: apiIngredients
      });
      router.push('/');
    } catch (err) {
      console.error(err);
      alert('Failed to save recipe');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gray-50 p-8 text-black">
      <div className="max-w-3xl mx-auto bg-white rounded-lg shadow p-8">
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-2xl font-bold">Create New Recipe</h1>
          <Link href="/" className="text-gray-500 hover:text-gray-700">Cancel</Link>
        </div>

        <form onSubmit={handleSubmit} className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="col-span-1 md:col-span-2">
              <label className="block text-sm font-medium text-gray-700 mb-1">Recipe Title</label>
              <input 
                type="text" 
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none"
                placeholder="e.g. Mom's Spaghetti"
                required
              />
            </div>
            <div className="col-span-1">
              <label className="block text-sm font-medium text-gray-700 mb-1">Servings</label>
              <input 
                type="number" 
                value={servings}
                onChange={(e) => setServings(Number(e.target.value))}
                className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none"
                min="1"
              />
            </div>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Instructions</label>
            <textarea 
              value={instructions}
              onChange={(e) => setInstructions(e.target.value)}
              className="w-full border rounded px-3 py-2 h-32 focus:ring-2 focus:ring-green-500 focus:outline-none"
              placeholder="Step 1..."
            />
          </div>

          <hr />

          <div>
            <div className="flex justify-between items-center mb-2">
              <label className="block text-sm font-medium text-gray-700">Ingredients</label>
              <button 
                type="button" 
                onClick={addRow}
                className="text-sm text-green-600 font-semibold hover:text-green-800"
              >
                + Add Ingredient
              </button>
            </div>

            <div className="space-y-2">
              {rows.map((row, index) => (
                <div key={index} className="flex gap-2 items-center flex-wrap md:flex-nowrap bg-gray-50 p-2 rounded">
                  
                  {/* Toggle Button */}
                  <div className="flex-grow min-w-[200px]">
                    {!row.isCustom ? (
                      <select 
                        value={row.ingredient_id}
                        onChange={(e) => {
                          if (e.target.value === 'CUSTOM_NEW') {
                            updateRow(index, 'isCustom', true);
                          } else {
                            updateRow(index, 'ingredient_id', e.target.value);
                          }
                        }}
                        className="w-full border rounded px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="">Select Ingredient...</option>
                        {availableIngredients.map(ing => (
                          <option key={ing.id} value={ing.id}>{ing.name}</option>
                        ))}
                        <option value="CUSTOM_NEW" className="font-bold text-blue-600">+ Type Custom Name...</option>
                      </select>
                    ) : (
                      <div className="flex gap-2">
                        <input 
                          type="text"
                          placeholder="Enter ingredient name..."
                          value={row.custom_name}
                          onChange={(e) => updateRow(index, 'custom_name', e.target.value)}
                          className="flex-grow border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                          autoFocus
                        />
                        <button 
                          type="button"
                          onClick={() => updateRow(index, 'isCustom', false)}
                          className="text-xs text-gray-500 underline"
                        >
                          Back to List
                        </button>
                      </div>
                    )}
                  </div>

                  {/* Quantity */}
                  <input 
                    type="text" 
                    placeholder="Qty"
                    value={row.quantity}
                    onChange={(e) => updateRow(index, 'quantity', e.target.value)}
                    className="w-20 border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />

                  {/* Unit */}
                  <input 
                    type="text" 
                    placeholder="Unit"
                    value={row.unit}
                    onChange={(e) => updateRow(index, 'unit', e.target.value)}
                    className="w-20 border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />

                  {/* Remove Button */}
                  <button 
                    type="button"
                    onClick={() => removeRow(index)}
                    className="text-red-500 hover:text-red-700 px-2"
                  >
                    
                  </button>
                </div>
              ))}
            </div>
          </div>

          <button 
            type="submit" 
            disabled={loading}
            className="w-full bg-green-600 text-white font-bold py-3 rounded hover:bg-green-700 transition disabled:opacity-50"
          >
            {loading ? 'Saving...' : 'Save Recipe'}
          </button>
        </form>
      </div>
    </div>
  );
}

================
File: web/src/app/register/page.tsx
================
'use client';

import { useState } from 'react';
import api from '@/lib/api';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

export default function RegisterPage() {
  const router = useRouter();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      await api.post('/auth/register', { email, password });
      router.push('/login');
    } catch (err: any) {
      setError(err.response?.data?.detail || 'Registration failed');
    }
  };

  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-100">
      <div className="w-full max-w-md p-8 space-y-6 bg-white rounded shadow-md text-black">
        <h2 className="text-2xl font-bold text-center">Register</h2>
        {error && <p className="text-red-500 text-center">{error}</p>}
        
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700">Email</label>
            <input 
              type="email" 
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              required 
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Password</label>
            <input 
              type="password" 
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              required 
            />
          </div>
          <button 
            type="submit" 
            className="w-full py-2 text-white bg-green-600 rounded hover:bg-green-700"
          >
            Create Account
          </button>
        </form>
        <p className="text-center text-sm text-gray-600">
          Already have an account? <Link href="/login" className="text-blue-500 hover:underline">Login</Link>
        </p>
      </div>
    </div>
  );
}

================
File: web/src/app/what-can-i-cook/page.tsx
================
'use client';

import { useQuery } from '@tanstack/react-query';
import api from '@/lib/api';
import Link from 'next/link';
import { useAuth } from '@/context/AuthContext';

interface MissingIngredient {
  name: string;
  missing_qty: string;
  unit: string;
}

interface RecipeMatch {
  id: string;
  title: string;
  servings: number;
  match_percentage: number;
  missing_ingredients: MissingIngredient[];
}

export default function WhatCanICook() {
  const { user } = useAuth();

  const { data: suggestions, isLoading } = useQuery<RecipeMatch[]>({
    queryKey: ['recipe-suggestions'],
    queryFn: async () => (await api.get('/recipes/suggestions')).data,
    enabled: !!user
  });

  if (!user) return null;

  return (
    <div className="min-h-screen bg-gray-50 p-8 text-black">
      <div className="max-w-4xl mx-auto">
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-3xl font-bold text-gray-800">What Can I Cook?</h1>
          <Link href="/" className="text-blue-600 hover:underline">
            Back to Dashboard
          </Link>
        </div>

        {isLoading ? (
          <p className="text-gray-500">Analyzing your fridge...</p>
        ) : suggestions?.length === 0 ? (
          <div className="bg-white p-8 rounded shadow text-center">
            <h2 className="text-xl font-semibold mb-2">No matches found.</h2>
            <p className="text-gray-600">Try adding more ingredients to your inventory!</p>
          </div>
        ) : (
          <div className="space-y-6">
            {suggestions?.map((recipe) => (
              <div key={recipe.id} className="bg-white rounded-lg shadow-md p-6 border border-gray-100">
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-800">{recipe.title}</h2>
                    <p className="text-sm text-gray-500">Serves {recipe.servings}</p>
                  </div>
                  
                  {/* Match Percentage Badge */}
                  <div className={`px-4 py-2 rounded-full font-bold text-white ${
                    recipe.match_percentage === 100 ? 'bg-green-600' :
                    recipe.match_percentage >= 50 ? 'bg-yellow-500' : 'bg-red-500'
                  }`}>
                    {recipe.match_percentage}% Match
                  </div>
                </div>

                {/* Progress Bar */}
                <div className="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                  <div 
                    className={`h-2.5 rounded-full ${
                      recipe.match_percentage === 100 ? 'bg-green-600' :
                      recipe.match_percentage >= 50 ? 'bg-yellow-400' : 'bg-red-400'
                    }`}
                    style={{ width: `${recipe.match_percentage}%` }}
                  ></div>
                </div>

                {/* Missing Ingredients Section */}
                {recipe.match_percentage < 100 && (
                  <div className="bg-red-50 p-4 rounded-lg border border-red-100">
                    <h3 className="text-sm font-bold text-red-800 uppercase mb-2">You are missing:</h3>
                    <ul className="list-disc list-inside text-sm text-red-700 space-y-1">
                      {recipe.missing_ingredients.map((ing, idx) => (
                        <li key={idx}>
                          {ing.missing_qty} {ing.unit} {ing.name}
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
                
                {recipe.match_percentage === 100 && (
                   <div className="text-green-700 font-medium bg-green-50 p-3 rounded border border-green-200">
                      You have everything you need to cook this!
                   </div>
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

================
File: web/src/context/AuthContext.tsx
================
'use client';

import { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import { useRouter } from 'next/navigation';
import Cookies from 'js-cookie';

interface User {
  email: string;
}

interface AuthContextType {
  user: User | null;
  login: (token: string, email: string) => void;
  logout: () => void;
  isLoading: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const router = useRouter();

  useEffect(() => {
    const token = Cookies.get('token');
    if (token) {
      // For now, we manually set the user since we don't have a /me endpoint yet
      // In the future, we will decode the token or fetch user data here
      setUser({ email: 'user@example.com' }); 
    }
    setIsLoading(false);
  }, []);

  const login = (token: string, email: string) => {
    Cookies.set('token', token, { expires: 1 }); // Expires in 1 day
    setUser({ email });
    router.push('/'); // Redirect to dashboard/home
  };

  const logout = () => {
    Cookies.remove('token');
    setUser(null);
    router.push('/login');
  };

  return (
    <AuthContext.Provider value={{ user, login, logout, isLoading }}>
      {children}
    </AuthContext.Provider>
  );
}

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) throw new Error('useAuth must be used within an AuthProvider');
  return context;
};

================
File: web/src/lib/api.ts
================
import axios from 'axios';
import Cookies from 'js-cookie';

const api = axios.create({
  baseURL: 'http://localhost:8000/api/v1', // Your FastAPI Backend URL
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request Interceptor: Attach Token
api.interceptors.request.use(
  (config) => {
    const token = Cookies.get('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response Interceptor: Handle 401 (Unauthorized)
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Token expired or invalid
      Cookies.remove('token');
      // Optional: Redirect to login if not already there
      if (window.location.pathname !== '/login') {
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);

export default api;

================
File: web/src/lib/providers.tsx
================
'use client';

import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { useState } from 'react';

export default function Providers({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(() => new QueryClient());

  return (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
}

================
File: web/tsconfig.json
================
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}



================================================================
End of Codebase
================================================================
