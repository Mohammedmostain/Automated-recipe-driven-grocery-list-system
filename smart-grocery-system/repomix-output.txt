This file is a merged representation of the entire codebase, combined into a single document.
Generated by Repomix on: 2025-12-26T01:52:23.913Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded

Additional Info:
----------------

================================================================
Directory Structure
================================================================
.gitignore
backend/alembic.ini
backend/alembic/env.py
backend/alembic/README
backend/alembic/script.py.mako
backend/alembic/versions/222cf417b60f_add_recipe_and_ingredient_tables.py
backend/alembic/versions/2e7a324c567a_add_is_selected_to_recipes.py
backend/alembic/versions/c5256c589d3e_create_user_table.py
backend/alembic/versions/e7b5cb225a11_add_inventory_table.py
backend/app/api/deps.py
backend/app/api/endpoints/auth.py
backend/app/api/endpoints/grocery.py
backend/app/api/endpoints/ingredients.py
backend/app/api/endpoints/inventory.py
backend/app/api/endpoints/recipes.py
backend/app/core/config.py
backend/app/core/security.py
backend/app/db/base.py
backend/app/db/session.py
backend/app/main.py
backend/app/models/ingredient.py
backend/app/models/inventory.py
backend/app/models/recipe.py
backend/app/models/user.py
backend/app/schemas/inventory.py
backend/app/schemas/recipe.py
backend/app/schemas/token.py
backend/app/schemas/user.py
backend/app/seed_ingredients.py
backend/app/utils/grocery_logic.py
backend/app/utils/suggestion_logic.py
backend/requirements.txt
docker-compose.yml
web/.gitignore
web/eslint.config.mjs
web/next.config.ts
web/package.json
web/postcss.config.mjs
web/public/file.svg
web/public/globe.svg
web/public/next.svg
web/public/vercel.svg
web/public/window.svg
web/README.md
web/repomix-output.txt
web/src/app/globals.css
web/src/app/grocery-list/page.tsx
web/src/app/inventory/page.tsx
web/src/app/layout.tsx
web/src/app/login/page.tsx
web/src/app/page.tsx
web/src/app/recipes/[id]/page.tsx
web/src/app/recipes/new/page.tsx
web/src/app/register/page.tsx
web/src/app/what-can-i-cook/page.tsx
web/src/context/AuthContext.tsx
web/src/lib/api.ts
web/src/lib/providers.tsx
web/tsconfig.json

================================================================
Files
================================================================

================
File: .gitignore
================
# ==========================
# GLOBAL / IDE
# ==========================
.DS_Store
Thumbs.db
.vscode/
.idea/
*.log

# ==========================
# BACKEND (Python/FastAPI)
# ==========================
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
dist/
*.egg-info/
.installed.cfg
*.egg

# Virtual Environment
venv/
env/
.venv/
backend/venv/

# Environment Variables (IMPORTANT)
.env
.env.*
!.env.example
backend/.env

# Database
*.sqlite3
*.db
postgres_data/

# ==========================
# FRONTEND (Next.js/Node)
# ==========================
node_modules/
web/node_modules/
.next/
web/.next/
web/out/
web/build/
web/dist/

# Next.js Environment
.env.local
.env.development.local
.env.test.local
.env.production.local
web/.env.local
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# Typescript
*.tsbuildinfo

================
File: backend/alembic.ini
================
# A generic, single database configuration.

[alembic]
# path to migration scripts
script_location = alembic

# template used to generate migration files
# file_template = %%(rev)s_%%(slug)s

# sys.path path, will be prepended to sys.path if present.
# defaults to the current working directory.
prepend_sys_path = .

# timezone to use when rendering the date within the migration file
# as well as the filename.
# string value is passed to dateutil.tz.gettz()
# leave blank for localtime
# timezone =

# max length of characters for slug field in migration filename
# truncate_slug_length = 40

# set to 'true' to run the environment during
# the 'revision' command, regardless of autogenerate
# revision_environment = false

# set to 'true' to allow .pyc and .pyo files without
# a source .py file to be detected as revisions in the
# versions/ directory
# sourceless = false

# version location specification; this defaults
# to alembic/versions.  When using multiple version
# directories, initial revisions must be specified with --version-path.
# version_locations = %(here)s/bar:%(here)s/bat:alembic/versions
# version_path_separator = :

# the output encoding used when revision files
# are written from script.py.mako
# output_encoding = utf-8

sqlalchemy.url = driver://user:pass@localhost/dbname


[post_write_hooks]
# post_write_hooks defines scripts or Python functions that are run
# on newly generated revision scripts.  See the documentation for further
# detail and examples

# http://alembic.zzzcomputing.com/en/latest/api/config.html#post-write-hooks

[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S

================
File: backend/alembic/env.py
================
import os
import sys
from logging.config import fileConfig

from sqlalchemy import engine_from_config
from sqlalchemy import pool

from alembic import context

# ------------------------------------------------------------------------
# 1. Add the current directory to sys.path so we can import from 'app'
#    This assumes you run alembic commands from the 'backend/' folder.
# ------------------------------------------------------------------------
sys.path.append(os.getcwd())

# 2. Import your application's settings and Base model
from app.core.config import settings
from app.db.base import Base  # This is where all models will be collected

# ------------------------------------------------------------------------
from app.models.user import User  # Import all models here so Alembic can see them
from app.models.ingredient import Ingredient  # <--- Add
from app.models.recipe import Recipe, RecipeIngredient # <--- Add
from app.models.inventory import Inventory  # <--- Add
# this is the Alembic Config object, which provides
# access to the values within the .ini file in use.
config = context.config

# 3. Overwrite the sqlalchemy.url in the config with the one from our environment settings
config.set_main_option("sqlalchemy.url", settings.DATABASE_URL)

# Interpret the config file for Python logging.
# This line sets up loggers basically.
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# 4. Set the target metadata so Alembic can see your models for autogeneration
target_metadata = Base.metadata

# other values from the config, defined by the needs of env.py,
# can be acquired:
# my_important_option = config.get_main_option("my_important_option")
# ... etc.


def run_migrations_offline() -> None:
    """Run migrations in 'offline' mode.

    This configures the context with just a URL
    and not an Engine, though an Engine is acceptable
    here as well.  By skipping the Engine creation
    we don't even need a DBAPI to be available.

    Calls to context.execute() here emit the given string to the
    script output.

    """
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()


def run_migrations_online() -> None:
    """Run migrations in 'online' mode.

    In this scenario we need to create an Engine
    and associate a connection with the context.

    """
    connectable = engine_from_config(
        config.get_section(config.config_ini_section, {}),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection, target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()


if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()

================
File: backend/alembic/README
================
Generic single-database configuration.

================
File: backend/alembic/script.py.mako
================
"""${message}

Revision ID: ${up_revision}
Revises: ${down_revision | comma,n}
Create Date: ${create_date}

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
${imports if imports else ""}

# revision identifiers, used by Alembic.
revision: str = ${repr(up_revision)}
down_revision: Union[str, Sequence[str], None] = ${repr(down_revision)}
branch_labels: Union[str, Sequence[str], None] = ${repr(branch_labels)}
depends_on: Union[str, Sequence[str], None] = ${repr(depends_on)}


def upgrade() -> None:
    """Upgrade schema."""
    ${upgrades if upgrades else "pass"}


def downgrade() -> None:
    """Downgrade schema."""
    ${downgrades if downgrades else "pass"}

================
File: backend/alembic/versions/222cf417b60f_add_recipe_and_ingredient_tables.py
================
"""add recipe and ingredient tables

Revision ID: 222cf417b60f
Revises: c5256c589d3e
Create Date: 2025-12-24 15:59:37.541621

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '222cf417b60f'
down_revision: Union[str, Sequence[str], None] = 'c5256c589d3e'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('ingredients',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.Column('aisle', sa.String(), nullable=False),
    sa.Column('default_unit', sa.String(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_ingredients_name'), 'ingredients', ['name'], unique=True)
    op.create_table('recipes',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('title', sa.String(), nullable=False),
    sa.Column('instructions', sa.Text(), nullable=True),
    sa.Column('servings', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('recipe_ingredients',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('recipe_id', sa.UUID(), nullable=False),
    sa.Column('ingredient_id', sa.UUID(), nullable=False),
    sa.Column('quantity', sa.String(), nullable=False),
    sa.Column('unit', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['ingredient_id'], ['ingredients.id'], ),
    sa.ForeignKeyConstraint(['recipe_id'], ['recipes.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('recipe_ingredients')
    op.drop_table('recipes')
    op.drop_index(op.f('ix_ingredients_name'), table_name='ingredients')
    op.drop_table('ingredients')
    # ### end Alembic commands ###

================
File: backend/alembic/versions/2e7a324c567a_add_is_selected_to_recipes.py
================
"""add is_selected to recipes

Revision ID: 2e7a324c567a
Revises: e7b5cb225a11
Create Date: 2025-12-24 17:12:25.843172

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '2e7a324c567a'
down_revision: Union[str, Sequence[str], None] = 'e7b5cb225a11'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('recipes', sa.Column('is_selected', sa.Boolean(), nullable=True))
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_column('recipes', 'is_selected')
    # ### end Alembic commands ###

================
File: backend/alembic/versions/c5256c589d3e_create_user_table.py
================
"""create user table

Revision ID: c5256c589d3e
Revises: 
Create Date: 2025-12-24 15:01:30.096976

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'c5256c589d3e'
down_revision: Union[str, Sequence[str], None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('users',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('email', sa.String(length=255), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=True),
    sa.Column('updated_at', sa.DateTime(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_users_email'), 'users', ['email'], unique=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_users_email'), table_name='users')
    op.drop_table('users')
    # ### end Alembic commands ###

================
File: backend/alembic/versions/e7b5cb225a11_add_inventory_table.py
================
"""add inventory table

Revision ID: e7b5cb225a11
Revises: 222cf417b60f
Create Date: 2025-12-24 16:58:32.676875

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'e7b5cb225a11'
down_revision: Union[str, Sequence[str], None] = '222cf417b60f'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('inventory',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('user_id', sa.UUID(), nullable=False),
    sa.Column('ingredient_id', sa.UUID(), nullable=False),
    sa.Column('quantity', sa.String(), nullable=False),
    sa.Column('unit', sa.String(), nullable=True),
    sa.ForeignKeyConstraint(['ingredient_id'], ['ingredients.id'], ),
    sa.ForeignKeyConstraint(['user_id'], ['users.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('inventory')
    # ### end Alembic commands ###

================
File: backend/app/api/deps.py
================
from typing import Generator, Optional
from fastapi import Depends, HTTPException, status
from fastapi.security import OAuth2PasswordBearer
from jose import jwt, JWTError
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.core.config import settings
from app.core import security
from app.models.user import User
from app.schemas.token import TokenData

# This tells FastAPI that the token comes from the "Authorization: Bearer <token>" header
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/api/v1/auth/login")

def get_current_user(
    db: Session = Depends(get_db),
    token: str = Depends(oauth2_scheme)
) -> User:
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="Could not validate credentials",
        headers={"WWW-Authenticate": "Bearer"},
    )
    try:
        payload = jwt.decode(token, settings.SECRET_KEY, algorithms=[settings.ALGORITHM])
        user_id: str = payload.get("sub")
        if user_id is None:
            raise credentials_exception
        token_data = TokenData(id=user_id)
    except JWTError:
        raise credentials_exception
        
    user = db.query(User).filter(User.id == token_data.id).first()
    if user is None:
        raise credentials_exception
    return user

================
File: backend/app/api/endpoints/auth.py
================
from datetime import timedelta
from typing import Any
from fastapi import APIRouter, Depends, HTTPException, status
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.orm import Session

from app.db.session import get_db
from app.core import security
from app.core.config import settings
from app.models.user import User
from app.schemas.user import UserCreate, UserResponse
from app.schemas.token import Token

router = APIRouter()

@router.post("/register", response_model=UserResponse)
def register(
    user_in: UserCreate,
    db: Session = Depends(get_db)
) -> Any:
    """
    Create new user.
    """
    # 1. Check if user already exists
    user = db.query(User).filter(User.email == user_in.email).first()
    if user:
        raise HTTPException(
            status_code=400,
            detail="The user with this username already exists in the system.",
        )
    
    # 2. Create new user
    user = User(
        email=user_in.email,
        password_hash=security.get_password_hash(user_in.password)
    )
    db.add(user)
    db.commit()
    db.refresh(user)
    return user

@router.post("/login", response_model=Token)
def login_access_token(
    db: Session = Depends(get_db),
    form_data: OAuth2PasswordRequestForm = Depends()
) -> Any:
    """
    OAuth2 compatible token login, get an access token for future requests.
    """
    # 1. Authenticate
    user = db.query(User).filter(User.email == form_data.username).first()
    if not user or not security.verify_password(form_data.password, user.password_hash):
        raise HTTPException(
            status_code=400, 
            detail="Incorrect email or password"
        )
    
    # 2. Create Token
    access_token_expires = timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    return {
        "access_token": security.create_access_token(
            subject=user.id, expires_delta=access_token_expires
        ),
        "token_type": "bearer",
    }

================
File: backend/app/api/endpoints/grocery.py
================
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.api import deps
from app.models.user import User
from app.utils.grocery_logic import generate_grocery_list
from typing import Dict, List

router = APIRouter()

# Schema for the response (A dictionary where Key=Aisle, Value=List of Items)
GroceryListResponse = Dict[str, List[dict]]

@router.get("/", response_model=GroceryListResponse)
def get_grocery_list(
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    """
    Calculate the shopping list based on selected recipes and current inventory.
    """
    return generate_grocery_list(db, current_user.id)

================
File: backend/app/api/endpoints/ingredients.py
================
from typing import List
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.models.ingredient import Ingredient
from pydantic import BaseModel
from uuid import UUID

class IngredientResponse(BaseModel):
    id: UUID
    name: str
    aisle: str
    default_unit: str | None
    
    class Config:
        from_attributes = True

router = APIRouter()

@router.get("/", response_model=List[IngredientResponse])
def read_ingredients(db: Session = Depends(get_db)):
    return db.query(Ingredient).order_by(Ingredient.name).all()

================
File: backend/app/api/endpoints/inventory.py
================
from typing import List
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session, joinedload
from app.db.session import get_db
from app.api import deps
from app.models.inventory import Inventory
from app.models.ingredient import Ingredient
from app.schemas.inventory import InventoryResponse, InventoryUpdate, InventoryCreate
from app.models.user import User

router = APIRouter()

@router.get("/", response_model=List[InventoryResponse])
def read_inventory(
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    items = db.query(Inventory).filter(Inventory.user_id == current_user.id)\
        .options(joinedload(Inventory.ingredient)).all()
    
    return [
        InventoryResponse(
            id=item.id,
            ingredient_id=item.ingredient_id,
            ingredient_name=item.ingredient.name,
            quantity=item.quantity,
            unit=item.unit
        ) for item in items
    ]

@router.post("/", response_model=InventoryResponse)
def add_inventory_item(
    item_in: InventoryCreate,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    # Check if item already exists in inventory
    existing = db.query(Inventory).filter(
        Inventory.user_id == current_user.id,
        Inventory.ingredient_id == item_in.ingredient_id
    ).options(joinedload(Inventory.ingredient)).first()

    if existing:
        existing.quantity = item_in.quantity
        existing.unit = item_in.unit
        db.commit()
        db.refresh(existing)
        return InventoryResponse(
            id=existing.id,
            ingredient_id=existing.ingredient_id,
            ingredient_name=existing.ingredient.name,
            quantity=existing.quantity,
            unit=existing.unit
        )

    # Create new
    new_item = Inventory(
        user_id=current_user.id,
        ingredient_id=item_in.ingredient_id,
        quantity=item_in.quantity,
        unit=item_in.unit
    )
    db.add(new_item)
    db.commit()
    db.refresh(new_item)
    
    # Reload to get ingredient name
    db.refresh(new_item, attribute_names=['ingredient'])
    
    return InventoryResponse(
        id=new_item.id,
        ingredient_id=new_item.ingredient_id,
        ingredient_name=new_item.ingredient.name,
        quantity=new_item.quantity,
        unit=new_item.unit
    )

@router.put("/{inventory_id}", response_model=InventoryResponse)
def update_inventory_item(
    inventory_id: str,
    item_in: InventoryUpdate,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    item = db.query(Inventory).filter(
        Inventory.id == inventory_id,
        Inventory.user_id == current_user.id
    ).options(joinedload(Inventory.ingredient)).first()

    if not item:
        raise HTTPException(status_code=404, detail="Item not found")

    item.quantity = item_in.quantity
    item.unit = item_in.unit
    db.commit()
    db.refresh(item)
    
    return InventoryResponse(
        id=item.id,
        ingredient_id=item.ingredient_id,
        ingredient_name=item.ingredient.name,
        quantity=item.quantity,
        unit=item.unit
    )
# ... (existing code)

@router.delete("/{inventory_id}", status_code=204)
def delete_inventory_item(
    inventory_id: str,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    """
    Remove an item from the user's inventory.
    """
    item = db.query(Inventory).filter(
        Inventory.id == inventory_id,
        Inventory.user_id == current_user.id
    ).first()

    if not item:
        raise HTTPException(status_code=404, detail="Item not found")

    db.delete(item)
    db.commit()
    return None# ... (existing code)

@router.delete("/{inventory_id}", status_code=204)
def delete_inventory_item(
    inventory_id: str,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    """
    Remove an item from the user's inventory.
    """
    item = db.query(Inventory).filter(
        Inventory.id == inventory_id,
        Inventory.user_id == current_user.id
    ).first()

    if not item:
        raise HTTPException(status_code=404, detail="Item not found")

    db.delete(item)
    db.commit()
    return None

================
File: backend/app/api/endpoints/recipes.py
================
from typing import List
from uuid import UUID
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from sqlalchemy.orm import joinedload
from sqlalchemy import func
from pydantic import BaseModel # <--- Ensure BaseModel is imported
from app.utils.suggestion_logic import suggest_recipes # <--- Import this
from app.schemas.recipe import RecipeSuggestion # <--- Import this

from app.db.session import get_db
from app.api import deps
from app.models.recipe import Recipe, RecipeIngredient
from app.models.ingredient import Ingredient
from app.models.user import User
from app.schemas.recipe import RecipeCreate, RecipeResponse, RecipeUpdate

router = APIRouter()

# --- Helper Function to Handle Custom Ingredients ---
def get_or_create_ingredient(db: Session, item) -> UUID:
    if item.ingredient_id:
        return item.ingredient_id

    if item.name:
        existing = db.query(Ingredient).filter(
            func.lower(Ingredient.name) == item.name.lower()
        ).first()
        
        if existing:
            return existing.id
        
        new_ing = Ingredient(
            name=item.name,
            aisle="Other",
            default_unit=item.unit
        )
        db.add(new_ing)
        db.flush()
        return new_ing.id
    
    raise HTTPException(status_code=400, detail="Ingredient must have either an ID or a Name")

# --- Helper Schema for Selection Toggle ---
class RecipeSelect(BaseModel):
    is_selected: bool

@router.get("/", response_model=List[RecipeResponse])
def read_recipes(
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    recipes = db.query(Recipe).filter(Recipe.user_id == current_user.id).options(
        joinedload(Recipe.ingredients).joinedload(RecipeIngredient.ingredient)
    ).all()
    
    results = []
    for r in recipes:
        r_dict = r.__dict__
        
        # --- FIX: Handle None values for existing recipes ---
        if r.is_selected is None:
            r_dict['is_selected'] = False
        # ---------------------------------------------------

        r_dict['ingredients'] = [
            {
                "id": ri.id,
                "ingredient_id": ri.ingredient_id,
                "name": ri.ingredient.name,
                "quantity": ri.quantity,
                "unit": ri.unit
            }
            for ri in r.ingredients
        ]
        results.append(r_dict)
    
    return results


@router.get("/suggestions", response_model=List[RecipeSuggestion])
def get_recipe_suggestions(
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    """
    Compare inventory against recipes and return sorted matches.
    """
    return suggest_recipes(db, current_user.id)


@router.get("/{recipe_id}", response_model=RecipeResponse)
def read_recipe(
    recipe_id: str,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    recipe = db.query(Recipe).filter(
        Recipe.id == recipe_id, 
        Recipe.user_id == current_user.id
    ).options(
        joinedload(Recipe.ingredients).joinedload(RecipeIngredient.ingredient)
    ).first()

    if not recipe:
        raise HTTPException(status_code=404, detail="Recipe not found")
    
    r_dict = recipe.__dict__
    
    # --- FIX: Handle None values for existing recipes ---
    if recipe.is_selected is None:
        r_dict['is_selected'] = False
    # ---------------------------------------------------

    r_dict['ingredients'] = [
        {
            "id": ri.id,
            "ingredient_id": ri.ingredient_id,
            "name": ri.ingredient.name,
            "quantity": ri.quantity,
            "unit": ri.unit
        }
        for ri in recipe.ingredients
    ]
    return r_dict

@router.post("/", response_model=RecipeResponse)
def create_recipe(
    recipe_in: RecipeCreate,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    new_recipe = Recipe(
        title=recipe_in.title,
        instructions=recipe_in.instructions,
        servings=recipe_in.servings,
        user_id=current_user.id
        # is_selected defaults to False in model, so it's safe here
    )
    db.add(new_recipe)
    db.flush() 

    for item in recipe_in.ingredients:
        ing_id = get_or_create_ingredient(db, item)
        recipe_ing = RecipeIngredient(
            recipe_id=new_recipe.id,
            ingredient_id=ing_id,
            quantity=item.quantity,
            unit=item.unit
        )
        db.add(recipe_ing)
    
    db.commit()
    db.refresh(new_recipe)
    return read_recipe(str(new_recipe.id), db, current_user)

@router.put("/{recipe_id}", response_model=RecipeResponse)
def update_recipe(
    recipe_id: str,
    recipe_in: RecipeUpdate,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    recipe = db.query(Recipe).filter(
        Recipe.id == recipe_id, 
        Recipe.user_id == current_user.id
    ).first()

    if not recipe:
        raise HTTPException(status_code=404, detail="Recipe not found")

    recipe.title = recipe_in.title
    recipe.instructions = recipe_in.instructions
    recipe.servings = recipe_in.servings

    db.query(RecipeIngredient).filter(RecipeIngredient.recipe_id == recipe.id).delete()
    
    for item in recipe_in.ingredients:
        ing_id = get_or_create_ingredient(db, item)
        new_ing = RecipeIngredient(
            recipe_id=recipe.id,
            ingredient_id=ing_id,
            quantity=item.quantity,
            unit=item.unit
        )
        db.add(new_ing)
    
    db.commit()
    db.refresh(recipe)
    return read_recipe(str(recipe.id), db, current_user)

@router.patch("/{recipe_id}/select", response_model=RecipeResponse)
def toggle_recipe_selection(
    recipe_id: str,
    selection: RecipeSelect,
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    """
    Toggle the 'is_selected' status of a recipe.
    """
    recipe = db.query(Recipe).filter(
        Recipe.id == recipe_id, 
        Recipe.user_id == current_user.id
    ).first()

    if not recipe:
        raise HTTPException(status_code=404, detail="Recipe not found")
    
    recipe.is_selected = selection.is_selected
    db.commit()
    db.refresh(recipe)
    
    return read_recipe(str(recipe.id), db, current_user)

@router.post("/clear-selection", status_code=200)
def clear_all_selections(
    db: Session = Depends(get_db),
    current_user: User = Depends(deps.get_current_user)
):
    """
    Unselect ALL recipes for the current user.
    """
    # efficient bulk update
    db.query(Recipe).filter(Recipe.user_id == current_user.id).update(
        {Recipe.is_selected: False}, synchronize_session=False
    )
    db.commit()
    return {"message": "Selection cleared"}

================
File: backend/app/core/config.py
================
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    PROJECT_NAME: str = "Smart Grocery System"
    DATABASE_URL: str
    
    # New Auth Config
    SECRET_KEY: str = "CHANGE_THIS_TO_A_SUPER_SECRET_KEY_IN_PROD" # Generates tokens
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30  # 30 mins for dev (Spec says 15, but 30 is easier for dev)

    class Config:
        env_file = ".env"

settings = Settings()

================
File: backend/app/core/security.py
================
from datetime import datetime, timedelta
from typing import Optional, Any, Union
from jose import jwt
from passlib.context import CryptContext
from app.core.config import settings

# Setup password hashing context (bcrypt)
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """Check if the plain password matches the hashed one."""
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    """Hash a password for storing."""
    return pwd_context.hash(password)

def create_access_token(subject: Union[str, Any], expires_delta: Optional[timedelta] = None) -> str:
    """Generate a JWT token."""
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=settings.ACCESS_TOKEN_EXPIRE_MINUTES)
    
    to_encode = {"exp": expire, "sub": str(subject)}
    encoded_jwt = jwt.encode(to_encode, settings.SECRET_KEY, algorithm=settings.ALGORITHM)
    return encoded_jwt

================
File: backend/app/db/base.py
================
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

# Later, import all your models here so Alembic can see them:
# from app.models.user import User
# from app.models.recipe import Recipe
# Import all models here so Alembic can see them
# from app.models.user import User  # <--- Add this line

================
File: backend/app/db/session.py
================
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from app.core.config import settings

# Create engine
# pool_pre_ping=True handles checking if the connection is alive before using it
engine = create_engine(settings.DATABASE_URL, pool_pre_ping=True)

# Create SessionLocal class
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# Dependency for API endpoints
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

================
File: backend/app/main.py
================
from fastapi import FastAPI
from app.core.config import settings
from app.api.endpoints import auth
from fastapi.middleware.cors import CORSMiddleware  # <--- Import this
from app.api.endpoints import auth, recipes, ingredients, inventory, grocery # <--- Import grocery
app = FastAPI(title=settings.PROJECT_NAME)


# --- ADD CORS MIDDLEWARE ---
origins = [
    "http://localhost:3000",  # Next.js frontend
    "http://127.0.0.1:3000",
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Include the Auth Router
# We prefix with /api/v1/auth to match your specs
app.include_router(auth.router, prefix="/api/v1/auth", tags=["auth"])
# --- 2. Include the recipes router ---
app.include_router(recipes.router, prefix="/api/v1/recipes", tags=["recipes"]) 

# --- 3. Include the ingredients router ---
app.include_router(ingredients.router, prefix="/api/v1/ingredients", tags=["ingredients"]) 
# --- 4. Include the inventory router ---
app.include_router(inventory.router, prefix="/api/v1/inventory", tags=["inventory"]) # <--- Add this
# --- 5. Include the grocery router ---
app.include_router(grocery.router, prefix="/api/v1/grocery", tags=["grocery"]) # <--- Add router

@app.get("/")
def root():
    return {"message": "Welcome to the Smart Grocery System API"}

================
File: backend/app/models/ingredient.py
================
import uuid
from sqlalchemy import Column, String
from sqlalchemy.dialects.postgresql import UUID
from app.db.base import Base

class Ingredient(Base):
    __tablename__ = "ingredients"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    name = Column(String, unique=True, nullable=False, index=True)
    aisle = Column(String, nullable=False)  # e.g., "Produce", "Spices"
    default_unit = Column(String, nullable=True)  # e.g., "kg", "jar"

================
File: backend/app/models/inventory.py
================
import uuid
from sqlalchemy import Column, String, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from app.db.base import Base

class Inventory(Base):
    __tablename__ = "inventory"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    ingredient_id = Column(UUID(as_uuid=True), ForeignKey("ingredients.id"), nullable=False)
    
    quantity = Column(String, nullable=False, default="0")
    unit = Column(String, nullable=True)

    # Relationships
    user = relationship("User", back_populates="inventory")
    ingredient = relationship("Ingredient")

================
File: backend/app/models/recipe.py
================
import uuid
from sqlalchemy import Column, String, Integer, ForeignKey, Text, Boolean # <--- Add Boolean
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from app.db.base import Base

class Recipe(Base):
    __tablename__ = "recipes"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    title = Column(String, nullable=False)
    instructions = Column(Text, nullable=True)
    servings = Column(Integer, default=4)
    is_selected = Column(Boolean, default=False) # <--- Add this line
    # Relationships
    user = relationship("User", back_populates="recipes")
    ingredients = relationship("RecipeIngredient", back_populates="recipe", cascade="all, delete-orphan")

class RecipeIngredient(Base):
    __tablename__ = "recipe_ingredients"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    recipe_id = Column(UUID(as_uuid=True), ForeignKey("recipes.id"), nullable=False)
    ingredient_id = Column(UUID(as_uuid=True), ForeignKey("ingredients.id"), nullable=False)
    
    quantity = Column(String, nullable=False) # e.g. "500", "1/2"
    unit = Column(String, nullable=True)      # e.g. "g", "cup"

    # Relationships
    recipe = relationship("Recipe", back_populates="ingredients")
    ingredient = relationship("Ingredient")

================
File: backend/app/models/user.py
================
import uuid
from datetime import datetime
from sqlalchemy import Column, String, DateTime
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship

from app.db.base import Base

class User(Base):
    __tablename__ = "users"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    email = Column(String(255), unique=True, nullable=False, index=True)
    password_hash = Column(String(255), nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    recipes = relationship("Recipe", back_populates="user", cascade="all, delete-orphan")
    inventory = relationship("Inventory", back_populates="user", cascade="all, delete-orphan")
    # Relationships (We will uncomment these later when we create the other models)
    # recipes = relationship("Recipe", back_populates="user", cascade="all, delete-orphan")
    # inventory = relationship("Inventory", back_populates="user", cascade="all, delete-orphan")

================
File: backend/app/schemas/inventory.py
================
from pydantic import BaseModel
from uuid import UUID
from typing import Optional

class InventoryBase(BaseModel):
    quantity: str
    unit: Optional[str] = None

class InventoryUpdate(InventoryBase):
    pass

class InventoryCreate(InventoryBase):
    ingredient_id: UUID

class InventoryResponse(InventoryBase):
    id: UUID
    ingredient_id: UUID
    ingredient_name: str # Mapped from relation

    class Config:
        from_attributes = True

================
File: backend/app/schemas/recipe.py
================
from pydantic import BaseModel
from typing import List, Optional
from uuid import UUID

# --- Nested Schemas ---

# Base schema for shared fields
class RecipeIngredientBase(BaseModel):
    quantity: str
    unit: Optional[str] = None

# INPUT schema: Now accepts EITHER ingredient_id OR name
class RecipeIngredientCreate(RecipeIngredientBase):
    ingredient_id: Optional[UUID] = None
    name: Optional[str] = None 

class RecipeIngredientResponse(RecipeIngredientBase):
    id: UUID
    ingredient_id: UUID
    name: str 

    class Config:
        from_attributes = True

# --- Recipe Schemas ---

class RecipeBase(BaseModel):
    title: str
    instructions: Optional[str] = None
    servings: int = 4
    is_selected: bool = False # <--- Add this

class RecipeCreate(RecipeBase):
    ingredients: List[RecipeIngredientCreate] = []

class RecipeUpdate(RecipeBase):
    ingredients: List[RecipeIngredientCreate] = []

class RecipeResponse(RecipeBase):
    id: UUID
    ingredients: List[RecipeIngredientResponse] = []
    is_selected: bool # <--- Add this
    
    class Config:
        from_attributes = True

class MissingIngredient(BaseModel):
    name: str
    missing_qty: str
    unit: str

class RecipeSuggestion(BaseModel):
    id: UUID
    title: str
    servings: int
    match_percentage: int
    missing_ingredients: List[MissingIngredient]

================
File: backend/app/schemas/token.py
================
from pydantic import BaseModel
from typing import Optional

class Token(BaseModel):
    access_token: str
    token_type: str

class TokenData(BaseModel):
    id: Optional[str] = None

================
File: backend/app/schemas/user.py
================
from pydantic import BaseModel, EmailStr
from uuid import UUID
from datetime import datetime

# Shared properties
class UserBase(BaseModel):
    email: EmailStr

# Properties to receive via API on creation
class UserCreate(UserBase):
    password: str

# Properties to return via API
class UserResponse(UserBase):
    id: UUID
    created_at: datetime

    class Config:
        from_attributes = True  # Allows Pydantic to read data from SQLAlchemy models

================
File: backend/app/seed_ingredients.py
================
import logging
from app.db.session import SessionLocal
from app.models.ingredient import Ingredient

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

COMMON_INGREDIENTS = [
    # Produce
    {"name": "Onion", "aisle": "Produce", "default_unit": "whole"},
    {"name": "Garlic", "aisle": "Produce", "default_unit": "clove"},
    {"name": "Tomato", "aisle": "Produce", "default_unit": "whole"},
    {"name": "Potato", "aisle": "Produce", "default_unit": "kg"},
    {"name": "Carrot", "aisle": "Produce", "default_unit": "whole"},
    {"name": "Spinach", "aisle": "Produce", "default_unit": "bunch"},
    
    # Meat
    {"name": "Chicken Breast", "aisle": "Meat", "default_unit": "kg"},
    {"name": "Ground Beef", "aisle": "Meat", "default_unit": "kg"},
    {"name": "Bacon", "aisle": "Meat", "default_unit": "pack"},
    
    # Dairy
    {"name": "Milk", "aisle": "Dairy", "default_unit": "L"},
    {"name": "Butter", "aisle": "Dairy", "default_unit": "block"},
    {"name": "Cheddar Cheese", "aisle": "Dairy", "default_unit": "block"},
    {"name": "Eggs", "aisle": "Dairy", "default_unit": "dozen"},
    
    # Pantry
    {"name": "Olive Oil", "aisle": "Oil & Vinegars", "default_unit": "L"},
    {"name": "Salt", "aisle": "Spices", "default_unit": "g"},
    {"name": "Black Pepper", "aisle": "Spices", "default_unit": "g"},
    {"name": "Rice", "aisle": "Grains", "default_unit": "kg"},
    {"name": "Pasta", "aisle": "Grains", "default_unit": "box"},
    {"name": "Flour", "aisle": "Baking", "default_unit": "kg"},
    {"name": "Sugar", "aisle": "Baking", "default_unit": "kg"},
]

def seed_ingredients():
    db = SessionLocal()
    try:
        logger.info("Starting ingredient seed...")
        count = 0
        for data in COMMON_INGREDIENTS:
            # Check if exists
            exists = db.query(Ingredient).filter(Ingredient.name == data["name"]).first()
            if not exists:
                ingredient = Ingredient(**data)
                db.add(ingredient)
                count += 1
        
        db.commit()
        logger.info(f"Successfully added {count} new ingredients.")
    except Exception as e:
        logger.error(f"Error seeding data: {e}")
        db.rollback()
    finally:
        db.close()

if __name__ == "__main__":
    seed_ingredients()

================
File: backend/app/utils/grocery_logic.py
================
from sqlalchemy.orm import Session
from typing import Dict, List
from app.models.recipe import Recipe
from app.models.inventory import Inventory
from app.models.ingredient import Ingredient
from uuid import UUID

def parse_quantity(qty_str: str) -> float:
    """
    Converts strings like '1.5', '1/2', '2' into floats.
    Returns 0.0 if parsing fails.
    """
    if not qty_str:
        return 0.0
    try:
        if '/' in qty_str:
            num, den = qty_str.split('/')
            return float(num) / float(den)
        return float(qty_str)
    except ValueError:
        return 0.0

def generate_grocery_list(db: Session, user_id: UUID) -> Dict[str, List[dict]]:
    """
    1. Aggregates ingredients from selected recipes.
    2. Subtracts inventory.
    3. Groups by Aisle.
    """
    
    # --- 1. Fetch Selected Recipes ---
    selected_recipes = db.query(Recipe).filter(
        Recipe.user_id == user_id, 
        Recipe.is_selected == True
    ).all()

    # Dictionary Key: (ingredient_id, unit) -> Value: { 'qty': float, 'obj': Ingredient }
    # We group by Unit as well because we can't subtract 'grams' from 'cups' easily in MVP
    needed_map = {}

    for recipe in selected_recipes:
        for r_ing in recipe.ingredients:
            key = (r_ing.ingredient_id, r_ing.unit)
            qty_val = parse_quantity(r_ing.quantity)

            if key not in needed_map:
                needed_map[key] = {
                    'qty': 0.0,
                    'ingredient': r_ing.ingredient
                }
            
            needed_map[key]['qty'] += qty_val

    # --- 2. Fetch Inventory & Subtract ---
    user_inventory = db.query(Inventory).filter(Inventory.user_id == user_id).all()

    for item in user_inventory:
        qty_val = parse_quantity(item.quantity)
        key = (item.ingredient_id, item.unit)

        # Only subtract if we actually need this item (and units match)
        if key in needed_map:
            needed_map[key]['qty'] -= qty_val

    # --- 3. Format & Group by Aisle ---
    final_list = {}

    for (ing_id, unit), data in needed_map.items():
        remaining_qty = data['qty']
        ingredient = data['ingredient']

        # If we still need it (greater than generic "epsilon" to handle float errors)
        if remaining_qty > 0.01:
            aisle = ingredient.aisle or "Other"
            
            if aisle not in final_list:
                final_list[aisle] = []

            # Format quantity back to pretty string if it's an integer
            display_qty = f"{remaining_qty:.2f}".rstrip('0').rstrip('.')
            
            final_list[aisle].append({
                "name": ingredient.name,
                "quantity": display_qty,
                "unit": unit or ""
            })

    return final_list

================
File: backend/app/utils/suggestion_logic.py
================
from sqlalchemy.orm import Session
from typing import List, Dict, Any
from app.models.recipe import Recipe
from app.models.inventory import Inventory
# We no longer need parse_quantity for the simplified logic

def suggest_recipes(db: Session, user_id: str) -> List[Dict[str, Any]]:
    """
    Returns a list of recipes sorted by how many ingredients the user CURRENTLY HAS,
    ignoring specific quantities/units (Boolean matching).
    """
    
    # 1. Fetch all Recipes and Inventory
    recipes = db.query(Recipe).filter(Recipe.user_id == user_id).all()
    inventory = db.query(Inventory).filter(Inventory.user_id == user_id).all()

    # 2. Build Inventory Set (Just IDs)
    # We use a Python Set for O(1) instant lookups
    owned_ingredient_ids = {item.ingredient_id for item in inventory}

    results = []

    # 3. Analyze Each Recipe
    for recipe in recipes:
        total_ingredients = len(recipe.ingredients)
        if total_ingredients == 0:
            continue

        missing_ingredients = []
        matches = 0

        for r_ing in recipe.ingredients:
            # SIMPLIFIED LOGIC:
            # If the recipe ingredient ID exists in our inventory set, it's a match.
            if r_ing.ingredient_id in owned_ingredient_ids:
                matches += 1
            else:
                # We don't have it at all.
                # The "missing amount" is simply the full amount required by the recipe.
                missing_ingredients.append({
                    "name": r_ing.ingredient.name,
                    "missing_qty": r_ing.quantity,
                    "unit": r_ing.unit
                })

        # Calculate Score
        match_percentage = int((matches / total_ingredients) * 100)

        results.append({
            "id": recipe.id,
            "title": recipe.title,
            "servings": recipe.servings,
            "match_percentage": match_percentage,
            "missing_ingredients": missing_ingredients
        })

    # 4. Sort by Match Percentage (Highest First)
    results.sort(key=lambda x: x['match_percentage'], reverse=True)
    
    return results

================
File: backend/requirements.txt
================
fastapi
uvicorn[standard]
sqlalchemy
alembic
psycopg2-binary
python-dotenv
pydantic
pydantic-settings
passlib[bcrypt]
python-jose[cryptography]
python-multipart
email-validator 
bcrypt==4.0.1

================
File: docker-compose.yml
================
version: '3.8'

services:
  db:
    image: postgres:15-alpine
    container_name: grocery_db
    restart: always
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=grocery_app
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:

================
File: web/.gitignore
================
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

================
File: web/eslint.config.mjs
================
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

================
File: web/next.config.ts
================
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;

================
File: web/package.json
================
{
  "name": "web",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@tanstack/react-query": "^5.90.12",
    "axios": "^1.13.2",
    "js-cookie": "^3.0.5",
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/js-cookie": "^3.0.6",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

================
File: web/postcss.config.mjs
================
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;

================
File: web/public/file.svg
================
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>

================
File: web/public/globe.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>

================
File: web/public/next.svg
================
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>

================
File: web/public/vercel.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>

================
File: web/public/window.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>

================
File: web/README.md
================
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

================
File: web/repomix-output.txt
================
This file is a merged representation of the entire codebase, combined into a single document.
Generated by Repomix on: 2025-12-24T22:31:54.716Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded

Additional Info:
----------------

================================================================
Directory Structure
================================================================
.gitignore
eslint.config.mjs
next.config.ts
package.json
postcss.config.mjs
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
README.md
src/app/globals.css
src/app/layout.tsx
src/app/page.tsx
tsconfig.json

================================================================
Files
================================================================

================
File: .gitignore
================
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

================
File: eslint.config.mjs
================
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;

================
File: next.config.ts
================
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;

================
File: package.json
================
{
  "name": "web",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "axios": "^1.13.2",
    "js-cookie": "^3.0.5",
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/js-cookie": "^3.0.6",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.1",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

================
File: postcss.config.mjs
================
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;

================
File: public/file.svg
================
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>

================
File: public/globe.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>

================
File: public/next.svg
================
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>

================
File: public/vercel.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>

================
File: public/window.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>

================
File: README.md
================
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

================
File: src/app/globals.css
================
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}

================
File: src/app/layout.tsx
================
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}

================
File: src/app/page.tsx
================
import Image from "next/image";

export default function Home() {
  return (
    <div className="flex min-h-screen items-center justify-center bg-zinc-50 font-sans dark:bg-black">
      <main className="flex min-h-screen w-full max-w-3xl flex-col items-center justify-between py-32 px-16 bg-white dark:bg-black sm:items-start">
        <Image
          className="dark:invert"
          src="/next.svg"
          alt="Next.js logo"
          width={100}
          height={20}
          priority
        />
        <div className="flex flex-col items-center gap-6 text-center sm:items-start sm:text-left">
          <h1 className="max-w-xs text-3xl font-semibold leading-10 tracking-tight text-black dark:text-zinc-50">
            To get started, edit the page.tsx file.
          </h1>
          <p className="max-w-md text-lg leading-8 text-zinc-600 dark:text-zinc-400">
            Looking for a starting point or more instructions? Head over to{" "}
            <a
              href="https://vercel.com/templates?framework=next.js&utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app"
              className="font-medium text-zinc-950 dark:text-zinc-50"
            >
              Templates
            </a>{" "}
            or the{" "}
            <a
              href="https://nextjs.org/learn?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app"
              className="font-medium text-zinc-950 dark:text-zinc-50"
            >
              Learning
            </a>{" "}
            center.
          </p>
        </div>
        <div className="flex flex-col gap-4 text-base font-medium sm:flex-row">
          <a
            className="flex h-12 w-full items-center justify-center gap-2 rounded-full bg-foreground px-5 text-background transition-colors hover:bg-[#383838] dark:hover:bg-[#ccc] md:w-[158px]"
            href="https://vercel.com/new?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app"
            target="_blank"
            rel="noopener noreferrer"
          >
            <Image
              className="dark:invert"
              src="/vercel.svg"
              alt="Vercel logomark"
              width={16}
              height={16}
            />
            Deploy Now
          </a>
          <a
            className="flex h-12 w-full items-center justify-center rounded-full border border-solid border-black/[.08] px-5 transition-colors hover:border-transparent hover:bg-black/[.04] dark:border-white/[.145] dark:hover:bg-[#1a1a1a] md:w-[158px]"
            href="https://nextjs.org/docs?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app"
            target="_blank"
            rel="noopener noreferrer"
          >
            Documentation
          </a>
        </div>
      </main>
    </div>
  );
}

================
File: tsconfig.json
================
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}



================================================================
End of Codebase
================================================================

================
File: web/src/app/globals.css
================
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}

================
File: web/src/app/grocery-list/page.tsx
================
'use client';

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import api from '@/lib/api';
import Link from 'next/link';
import { useAuth } from '@/context/AuthContext';
import { useState } from 'react';

// --- Interfaces ---
interface GroceryItem {
  name: string;
  quantity: string;
  unit: string;
}

interface Recipe {
  id: string;
  title: string;
  is_selected: boolean;
}

type GroceryListResponse = Record<string, GroceryItem[]>;

export default function GroceryListPage() {
  const { user } = useAuth();
  const queryClient = useQueryClient();
  
  // Local state to track items "checked off" while shopping (visual only)
  const [checkedItems, setCheckedItems] = useState<Record<string, boolean>>({});

  // 1. Fetch Data
  const { data: recipes } = useQuery<Recipe[]>({
    queryKey: ['recipes'],
    queryFn: async () => (await api.get('/recipes')).data,
    enabled: !!user
  });

  const { data: groceryList, isLoading: isListLoading } = useQuery<GroceryListResponse>({
    queryKey: ['grocery-list'],
    queryFn: async () => (await api.get('/grocery')).data,
    enabled: !!user
  });

  // 2. Toggle Single Recipe
  const toggleMutation = useMutation({
    mutationFn: async ({ id, is_selected }: { id: string; is_selected: boolean }) => {
      return api.patch(`/recipes/${id}/select`, { is_selected });
    },
    onMutate: async ({ id, is_selected }) => {
      await queryClient.cancelQueries({ queryKey: ['recipes'] });
      const prev = queryClient.getQueryData<Recipe[]>(['recipes']);
      queryClient.setQueryData<Recipe[]>(['recipes'], (old) => 
        old?.map(r => r.id === id ? { ...r, is_selected } : r)
      );
      return { prev };
    },
    onSettled: () => {
      queryClient.invalidateQueries({ queryKey: ['recipes'] });
      queryClient.invalidateQueries({ queryKey: ['grocery-list'] });
    }
  });

  // 3. Clear ALL Selection
  const clearAllMutation = useMutation({
    mutationFn: async () => {
      return api.post('/recipes/clear-selection');
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['recipes'] });
      queryClient.invalidateQueries({ queryKey: ['grocery-list'] });
      setCheckedItems({}); // Reset local checks
    }
  });

  const activeCount = recipes?.filter(r => r.is_selected).length || 0;
  const isEmpty = !groceryList || Object.keys(groceryList).length === 0;

  const toggleItemCheck = (id: string) => {
    setCheckedItems(prev => ({ ...prev, [id]: !prev[id] }));
  };

  if (!user) return null;

  return (
    <div className="min-h-screen bg-gray-100 text-gray-900 font-sans flex flex-col md:flex-row">
      
      {/* --- SIDEBAR (Recipe Controller) --- */}
      <aside className="w-full md:w-80 bg-white border-r border-gray-200 flex-shrink-0 md:h-screen md:sticky md:top-0 overflow-y-auto z-10">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6">
            <Link href="/" className="text-sm font-semibold text-blue-600 hover:text-blue-800 flex items-center">
              <span className="mr-1"></span> Dashboard
            </Link>
          </div>

          <div className="mb-6">
            <h2 className="text-2xl font-bold tracking-tight text-gray-900">Your Menu</h2>
            <div className="flex justify-between items-baseline mt-2">
              <p className="text-sm text-gray-500 font-medium">
                {activeCount} {activeCount === 1 ? 'recipe' : 'recipes'} selected
              </p>
              
              {activeCount > 0 && (
                <button 
                  onClick={() => clearAllMutation.mutate()}
                  disabled={clearAllMutation.isPending}
                  className="text-xs font-bold text-red-500 hover:text-red-700 uppercase tracking-wide disabled:opacity-50"
                >
                  {clearAllMutation.isPending ? 'Clearing...' : 'Clear All'}
                </button>
              )}
            </div>
          </div>

          <div className="space-y-2">
            {recipes?.map(recipe => (
              <label 
                key={recipe.id} 
                className={`group flex items-center justify-between p-3 rounded-xl border-2 cursor-pointer transition-all duration-200 ${
                  recipe.is_selected 
                    ? 'bg-blue-50 border-blue-500 shadow-sm' 
                    : 'bg-white border-transparent hover:bg-gray-50'
                }`}
              >
                <span className={`text-sm font-medium transition-colors ${
                  recipe.is_selected ? 'text-blue-900' : 'text-gray-600 group-hover:text-gray-900'
                }`}>
                  {recipe.title}
                </span>
                
                <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${
                    recipe.is_selected ? 'bg-blue-500 border-blue-500' : 'border-gray-300'
                }`}>
                    {recipe.is_selected && (
                        <svg className="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                        </svg>
                    )}
                </div>

                <input 
                  type="checkbox"
                  className="hidden"
                  checked={recipe.is_selected}
                  onChange={(e) => toggleMutation.mutate({ 
                    id: recipe.id, 
                    is_selected: e.target.checked 
                  })}
                />
              </label>
            ))}
          </div>
        </div>
      </aside>

      {/* --- MAIN CONTENT (The Grocery List) --- */}
      <main className="flex-1 p-4 md:p-8 lg:p-12 overflow-y-auto">
        <header className="max-w-3xl mx-auto mb-8 flex items-center justify-between">
          <div>
            <h1 className="text-3xl md:text-4xl font-extrabold text-gray-900 tracking-tight">Shopping List</h1>
            <p className="text-gray-500 mt-2">Grouped by aisle for faster shopping</p>
          </div>
          {isListLoading && (
            <div className="h-6 w-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
          )}
        </header>

        {isEmpty ? (
          <div className="max-w-md mx-auto mt-20 text-center">
            <div className="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
              <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                
              </div>
              <h3 className="text-xl font-bold text-gray-900 mb-2">Your list is empty</h3>
              <p className="text-gray-500 mb-6">Select recipes from the menu on the left to automatically generate your shopping list.</p>
              <div className="text-sm text-blue-500 font-medium bg-blue-50 inline-block px-4 py-2 rounded-full">
                Waiting for recipes...
              </div>
            </div>
          </div>
        ) : (
          <div className="max-w-3xl mx-auto space-y-8 pb-20">
            {groceryList && Object.entries(groceryList).map(([aisle, items]) => (
              <div key={aisle} className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                {/* Aisle Header */}
                <div className="bg-gray-50 px-6 py-3 border-b border-gray-100 flex justify-between items-center">
                  <h3 className="font-bold text-gray-800 uppercase tracking-wider text-xs">{aisle}</h3>
                  <span className="bg-white text-gray-500 text-xs font-bold px-2 py-1 rounded-md border border-gray-200 shadow-sm">
                    {items.length} items
                  </span>
                </div>

                {/* Items List */}
                <ul className="divide-y divide-gray-100">
                  {items.map((item, idx) => {
                    const uniqueKey = `${aisle}-${item.name}-${idx}`;
                    const isChecked = checkedItems[uniqueKey];

                    return (
                      <li 
                        key={uniqueKey} 
                        onClick={() => toggleItemCheck(uniqueKey)}
                        className={`group px-6 py-4 flex items-center justify-between cursor-pointer transition-colors hover:bg-gray-50 select-none ${
                            isChecked ? 'bg-gray-50' : 'bg-white'
                        }`}
                      >
                        <div className="flex items-center gap-4">
                          {/* Custom Checkbox Circle */}
                          <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-300 ${
                            isChecked 
                                ? 'bg-green-500 border-green-500 scale-110' 
                                : 'border-gray-300 group-hover:border-blue-400'
                          }`}>
                            {isChecked && (
                                <svg className="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                                </svg>
                            )}
                          </div>
                          
                          <span className={`font-medium text-lg transition-all duration-300 ${
                            isChecked ? 'text-gray-400 line-through' : 'text-gray-800'
                          }`}>
                            {item.name}
                          </span>
                        </div>

                        <span className={`text-sm font-semibold px-3 py-1 rounded-lg transition-colors ${
                            isChecked 
                                ? 'bg-gray-200 text-gray-400' 
                                : 'bg-blue-50 text-blue-700'
                        }`}>
                          {item.quantity} {item.unit}
                        </span>
                      </li>
                    );
                  })}
                </ul>
              </div>
            ))}
            
            {/* End of list decoration */}
            <div className="text-center text-gray-300 text-sm mt-8">
               End of List 
            </div>
          </div>
        )}
      </main>
    </div>
  );
}

================
File: web/src/app/inventory/page.tsx
================
'use client';

import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import api from '@/lib/api';
import Link from 'next/link';
import { useAuth } from '@/context/AuthContext';

// --- Types matching YOUR existing Backend ---
interface InventoryItem {
  id: string;
  ingredient_id: string;
  ingredient_name: string; // <--- Flat string (No nested object)
  quantity: string;
  unit: string;
}

interface IngredientOption {
  id: string;
  name: string;
  default_unit: string;
}

export default function InventoryPage() {
  const { user } = useAuth();
  const queryClient = useQueryClient();
  
  // State for the "Add" form
  const [newItemId, setNewItemId] = useState('');

  // 1. Fetch Inventory
  const { data: inventory, isLoading } = useQuery<InventoryItem[]>({
    queryKey: ['inventory'],
    queryFn: async () => (await api.get('/inventory')).data,
    enabled: !!user
  });

  // 2. Fetch Ingredients (for dropdown)
  const { data: ingredients } = useQuery<IngredientOption[]>({
    queryKey: ['ingredients'],
    queryFn: async () => (await api.get('/ingredients')).data,
    enabled: !!user
  });

  // 3. Mutation: Update Quantity/Unit
  const updateMutation = useMutation({
    mutationFn: async ({ id, quantity, unit }: { id: string; quantity: string; unit: string }) => {
      return api.put(`/inventory/${id}`, { quantity, unit });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['inventory'] });
    }
  });

  // 4. Mutation: Add New Item
  const addMutation = useMutation({
    mutationFn: async (ingredient_id: string) => {
      const ing = ingredients?.find(i => i.id === ingredient_id);
      return api.post('/inventory', { 
        ingredient_id, 
        quantity: "1", 
        unit: ing?.default_unit || "unit" 
      });
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['inventory'] });
      setNewItemId('');
    }
  });

  // 5. Mutation: Delete Item (Standard API call)
  const deleteMutation = useMutation({
    mutationFn: (id: string) => api.delete(`/inventory/${id}`),
    onSuccess: () => queryClient.invalidateQueries({ queryKey: ['inventory'] }),
  });

  if (!user) return null;

  return (
    <div className="min-h-screen bg-gray-50 p-4 md:p-8 font-sans text-gray-900">
      <div className="max-w-4xl mx-auto">
        
        {/* --- Header --- */}
        <div className="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
          <div>
            <h1 className="text-3xl font-extrabold text-gray-900 tracking-tight">My Fridge</h1>
            <p className="text-gray-500">Track what you already have at home</p>
          </div>
          <Link href="/" className="text-sm font-semibold text-gray-500 hover:text-gray-900 bg-white px-4 py-2 rounded-xl border border-gray-200 shadow-sm transition">
             Back to Cookbook
          </Link>
        </div>

        {/* --- "Quick Add" Card --- */}
        <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 mb-8">
          <h2 className="text-lg font-bold text-gray-800 mb-4">Quick Add Item</h2>
          <div className="flex gap-3">
             <div className="relative flex-grow">
                <select 
                    className="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none transition"
                    value={newItemId}
                    onChange={(e) => setNewItemId(e.target.value)}
                >
                    <option value="">Select an ingredient...</option>
                    {ingredients?.map(ing => (
                    <option key={ing.id} value={ing.id}>{ing.name}</option>
                    ))}
                </select>
                {/* Custom arrow icon for select */}
                <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">
                    <svg className="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
             </div>
            
            <button 
              disabled={!newItemId || addMutation.isPending}
              onClick={() => addMutation.mutate(newItemId)}
              className="bg-gray-900 text-white px-6 py-3 rounded-xl font-bold hover:bg-black transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap"
            >
              {addMutation.isPending ? 'Adding...' : 'Add Item'}
            </button>
          </div>
        </div>

        {/* --- Inventory List --- */}
        <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
            <div className="bg-gray-50 px-6 py-4 border-b border-gray-100 flex justify-between items-center">
                <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider">Current Stock</h3>
                <span className="text-xs font-semibold bg-white border border-gray-200 px-2 py-1 rounded text-gray-500">
                    {inventory?.length || 0} items
                </span>
            </div>
          
          {isLoading ? (
            <div className="p-12 text-center text-gray-400">Loading your fridge...</div>
          ) : inventory?.length === 0 ? (
            <div className="p-12 text-center text-gray-400">
              <div className="text-4xl mb-3"></div>
              <p>Your fridge is empty.</p>
            </div>
          ) : (
            <ul className="divide-y divide-gray-100">
              {inventory?.map((item) => (
                <li key={item.id} className="px-6 py-4 flex flex-col sm:flex-row sm:items-center justify-between group hover:bg-gray-50 transition gap-4">
                  
                  {/* Left: Avatar & Name */}
                  <div className="flex items-center gap-4">
                     <div className="w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center text-lg font-bold shadow-sm">
                        {/* Use item.ingredient_name safely */}
                        {(item.ingredient_name || "?").charAt(0).toUpperCase()}
                     </div>
                     <div>
                        <p className="font-bold text-gray-900">{item.ingredient_name}</p>
                        {/* We don't have aisle in this data model, so we omit it or default it */}
                     </div>
                  </div>

                  {/* Right: Editable Controls */}
                  <div className="flex items-center gap-3 w-full sm:w-auto bg-white sm:bg-transparent p-2 sm:p-0 rounded-xl border sm:border-0 border-gray-100">
                    
                    {/* Quantity Input */}
                    <input 
                        type="text" 
                        className="w-16 p-2 bg-gray-50 border border-gray-200 rounded-lg text-center font-bold text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        defaultValue={item.quantity}
                        onBlur={(e) => {
                            if (e.target.value !== item.quantity) {
                                updateMutation.mutate({ id: item.id, quantity: e.target.value, unit: item.unit });
                            }
                        }}
                        onKeyDown={(e) => e.key === 'Enter' && e.currentTarget.blur()}
                    />

                    {/* Unit Input */}
                    <input 
                        type="text" 
                        className="w-20 p-2 bg-gray-50 border border-gray-200 rounded-lg text-center text-sm font-semibold text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        defaultValue={item.unit}
                        onBlur={(e) => {
                            if (e.target.value !== item.unit) {
                                updateMutation.mutate({ id: item.id, quantity: item.quantity, unit: e.target.value });
                            }
                        }}
                        onKeyDown={(e) => e.key === 'Enter' && e.currentTarget.blur()}
                    />

                    {/* Delete Button */}
                    <button 
                      onClick={() => deleteMutation.mutate(item.id)}
                      className="ml-2 w-8 h-8 flex items-center justify-center text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-full transition"
                      title="Remove Item"
                    >
                      <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                      </svg>
                    </button>
                  </div>
                </li>
              ))}
            </ul>
          )}
        </div>
      </div>
    </div>
  );
}

================
File: web/src/app/layout.tsx
================
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { AuthProvider } from "@/context/AuthContext";
import Providers from "@/lib/providers"; // <--- Import TanStack Query Provider

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Smart Grocery System",
  description: "Automated grocery lists",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {/* Wrap everything in Providers first, then AuthProvider */}
        <Providers>
          <AuthProvider>
            {children}
          </AuthProvider>
        </Providers>
      </body>
    </html>
  );
}

================
File: web/src/app/login/page.tsx
================
'use client';

import { useState } from 'react';
import { useAuth } from '@/context/AuthContext';
import api from '@/lib/api';
import Link from 'next/link';

export default function LoginPage() {
  const { login } = useAuth();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    
    try {
      // FastAPI expects form-data for OAuth2 login
      const formData = new FormData();
      formData.append('username', email);
      formData.append('password', password);

      const res = await api.post('/auth/login', formData, {
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
      });
      
      login(res.data.access_token, email);
    } catch (err: any) {
      console.error(err);
      setError('Invalid email or password');
    }
  };

  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-100">
      <div className="w-full max-w-md p-8 space-y-6 bg-white rounded shadow-md text-black">
        <h2 className="text-2xl font-bold text-center">Login</h2>
        {error && <p className="text-red-500 text-center">{error}</p>}
        
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700">Email</label>
            <input 
              type="email" 
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              required 
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Password</label>
            <input 
              type="password" 
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              required 
            />
          </div>
          <button 
            type="submit" 
            className="w-full py-2 text-white bg-blue-600 rounded hover:bg-blue-700"
          >
            Sign In
          </button>
        </form>
        <p className="text-center text-sm text-gray-600">
          Don't have an account? <Link href="/register" className="text-blue-500 hover:underline">Register</Link>
        </p>
      </div>
    </div>
  );
}

================
File: web/src/app/page.tsx
================
'use client';

import api from '@/lib/api';
import Link from 'next/link';
import { useAuth } from '@/context/AuthContext';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';

interface Ingredient {
  name: string;
  quantity: string;
  unit: string;
}

interface Recipe {
  id: string;
  title: string;
  servings: number;
  ingredients: Ingredient[];
  is_selected: boolean;
}

export default function Dashboard() {
  const { user, logout } = useAuth();
  const queryClient = useQueryClient();

  const { data: recipes, isLoading } = useQuery<Recipe[]>({
    queryKey: ['recipes'],
    queryFn: async () => (await api.get('/recipes')).data,
    enabled: !!user 
  });

  const toggleMutation = useMutation({
    mutationFn: async ({ id, is_selected }: { id: string; is_selected: boolean }) => {
      return api.patch(`/recipes/${id}/select`, { is_selected });
    },
    onMutate: async ({ id, is_selected }) => {
      await queryClient.cancelQueries({ queryKey: ['recipes'] });
      const previousRecipes = queryClient.getQueryData<Recipe[]>(['recipes']);
      queryClient.setQueryData<Recipe[]>(['recipes'], (old) => {
        if (!old) return [];
        return old.map((recipe) =>
          recipe.id === id ? { ...recipe, is_selected } : recipe
        );
      });
      return { previousRecipes };
    },
    onSettled: () => {
      queryClient.invalidateQueries({ queryKey: ['recipes'] });
    },
  });

  if (!user) return null;

  return (
    <div className="min-h-screen bg-gray-50 p-4 md:p-8 font-sans text-gray-900">
      {/* --- HEADER --- */}
      <header className="max-w-6xl mx-auto mb-10">
        <div className="flex flex-col md:flex-row justify-between items-center gap-6">
          <div>
            <h1 className="text-3xl font-extrabold tracking-tight text-gray-900">My Cookbook</h1>
            <p className="text-gray-500 mt-1">Select recipes to build your shopping list</p>
          </div>
          
          <div className="flex flex-wrap gap-3 justify-center">
             <Link 
              href="/what-can-i-cook" 
              className="bg-purple-100 text-purple-700 px-4 py-2 rounded-xl font-bold text-sm hover:bg-purple-200 transition shadow-sm"
            >
               Magic Suggest
            </Link>
            
            <Link 
              href="/grocery-list" 
              className="bg-blue-600 text-white px-5 py-2 rounded-xl font-bold text-sm shadow-md hover:bg-blue-700 transition flex items-center gap-2 transform hover:-translate-y-0.5"
            >
               Shopping List
            </Link>

            <Link 
              href="/inventory" 
              className="bg-white text-gray-700 border border-gray-200 px-4 py-2 rounded-xl font-semibold text-sm hover:bg-gray-50 transition"
            >
              My Fridge
            </Link>
             <button 
              onClick={logout} 
              className="text-gray-400 hover:text-red-500 font-medium text-sm px-3"
            >
              Sign Out
            </button>
          </div>
        </div>
      </header>

      {/* --- CONTENT --- */}
      <main className="max-w-6xl mx-auto">
        {isLoading ? (
          <div className="text-center py-20">
             <div className="h-8 w-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
             <p className="text-gray-400">Opening cookbook...</p>
          </div>
        ) : recipes?.length === 0 ? (
          <div className="text-center py-24 bg-white rounded-3xl shadow-sm border border-gray-100">
            <div className="text-5xl mb-4"></div>
            <h3 className="text-xl font-bold text-gray-900 mb-2">Empty Cookbook</h3>
            <p className="text-gray-500 mb-6">You haven't added any recipes yet.</p>
            <Link href="/recipes/new" className="bg-green-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-green-700 transition">
              Create First Recipe
            </Link>
          </div>
        ) : (
          <>
            <div className="flex justify-end mb-6">
                 <Link 
                  href="/recipes/new" 
                  className="bg-white text-green-600 border border-green-200 px-4 py-2 rounded-xl font-bold text-sm hover:bg-green-50 transition shadow-sm flex items-center gap-2"
                >
                  + New Recipe
                </Link>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {recipes?.map((recipe) => (
                <div 
                  key={recipe.id} 
                  className={`group relative bg-white rounded-2xl shadow-sm border transition-all duration-300 hover:shadow-md ${
                    recipe.is_selected ? 'border-blue-500 ring-1 ring-blue-500' : 'border-gray-200'
                  }`}
                >
                  {/* Selection Checkbox (Floating) */}
                  <div className="absolute top-4 right-4 z-20">
                     <label className={`flex items-center justify-center w-10 h-10 rounded-full cursor-pointer transition-all shadow-sm ${
                        recipe.is_selected ? 'bg-blue-500 text-white' : 'bg-white text-gray-300 border border-gray-200 hover:border-blue-300'
                     }`}>
                        <input 
                            type="checkbox"
                            checked={recipe.is_selected}
                            onChange={(e) => toggleMutation.mutate({ 
                              id: recipe.id, 
                              is_selected: e.target.checked 
                            })}
                            className="hidden"
                        />
                        {recipe.is_selected ? (
                           <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" /></svg>
                        ) : (
                           <span className="text-xl font-bold leading-none mb-1">+</span>
                        )}
                     </label>
                  </div>

                  {/* Clickable Card Body */}
                  <Link href={`/recipes/${recipe.id}`} className="block p-6 h-full">
                    <div className="pr-12">
                      <h2 className={`text-xl font-bold mb-1 group-hover:text-blue-600 transition-colors ${
                          recipe.is_selected ? 'text-blue-900' : 'text-gray-900'
                      }`}>
                        {recipe.title}
                      </h2>
                      <p className="text-sm text-gray-500 font-medium bg-gray-100 inline-block px-2 py-1 rounded-md">
                        {recipe.servings} Servings
                      </p>
                    </div>
                    
                    <div className="mt-6 pt-4 border-t border-gray-50">
                        <p className="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Ingredients</p>
                        <ul className="space-y-1">
                        {recipe.ingredients.slice(0, 3).map((ing, idx) => (
                            <li key={idx} className="text-sm text-gray-600 flex justify-between">
                                <span className="truncate pr-2">{ing.name}</span>
                                <span className="text-gray-400 text-xs">{ing.quantity} {ing.unit}</span>
                            </li>
                        ))}
                        </ul>
                         {recipe.ingredients.length > 3 && (
                            <p className="text-xs text-blue-500 font-medium mt-2">+ {recipe.ingredients.length - 3} more items</p>
                        )}
                    </div>
                  </Link>
                </div>
              ))}
            </div>
          </>
        )}
      </main>
    </div>
  );
}

================
File: web/src/app/recipes/[id]/page.tsx
================
'use client';

import { useQuery } from '@tanstack/react-query';
import api from '@/lib/api';
import Link from 'next/link';
import { useParams } from 'next/navigation';
import { useAuth } from '@/context/AuthContext';

interface Ingredient {
  name: string;
  quantity: string;
  unit: string;
}

interface Recipe {
  id: string;
  title: string;
  servings: number;
  instructions: string;
  ingredients: Ingredient[];
}

export default function RecipeDetailPage() {
  const { id } = useParams();
  const { user } = useAuth();

  const { data: recipe, isLoading, error } = useQuery<Recipe>({
    queryKey: ['recipe', id],
    queryFn: async () => (await api.get(`/recipes/${id}`)).data,
    enabled: !!user && !!id
  });

  if (isLoading) return <div className="min-h-screen bg-gray-50 flex items-center justify-center"><div className="animate-spin h-8 w-8 border-2 border-blue-600 rounded-full border-t-transparent"></div></div>;
  if (error || !recipe) return <div className="p-8 text-center text-red-500">Recipe not found</div>;

  return (
    <div className="min-h-screen bg-gray-100 p-4 md:p-10 font-sans text-gray-900 flex justify-center">
      <div className="max-w-4xl w-full bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100">
        
        {/* Navbar inside the card */}
        <div className="bg-white border-b border-gray-100 px-8 py-6 flex justify-between items-center sticky top-0 z-10">
             <Link 
                href="/" 
                className="text-sm font-bold text-gray-500 hover:text-gray-900 flex items-center gap-1"
            >
                 Back to Menu
            </Link>
             <div className="text-xs font-bold bg-green-50 text-green-700 px-3 py-1 rounded-full uppercase tracking-wider">
                Recipe
            </div>
        </div>

        {/* Hero Section */}
        <div className="px-8 md:px-12 py-10 bg-gradient-to-br from-blue-50 to-white">
            <h1 className="text-4xl md:text-5xl font-extrabold tracking-tight text-gray-900 mb-4">{recipe.title}</h1>
            <div className="flex items-center gap-6">
                 <div className="flex items-center gap-2 text-gray-600 font-medium">
                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                    <span>{recipe.servings} Servings</span>
                 </div>
                 {/* Placeholder for future "Time" field */}
                 <div className="flex items-center gap-2 text-gray-600 font-medium">
                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <span>25 mins</span>
                 </div>
            </div>
        </div>

        <div className="grid md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-gray-100">
            {/* Ingredients Sidebar */}
            <div className="md:col-span-1 bg-gray-50/50 p-8">
                <h2 className="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
                    Ingredients
                </h2>
                <ul className="space-y-4">
                    {recipe.ingredients.map((ing, idx) => (
                        <li key={idx} className="flex justify-between items-start text-sm group">
                            <span className="font-medium text-gray-700 group-hover:text-gray-900 transition-colors">{ing.name}</span>
                            <span className="font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded ml-2 whitespace-nowrap">{ing.quantity} {ing.unit}</span>
                        </li>
                    ))}
                </ul>
            </div>

            {/* Instructions Main Area */}
            <div className="md:col-span-2 p-8 md:p-12">
                <h2 className="text-2xl font-bold text-gray-900 mb-6">Preparation</h2>
                <div className="prose prose-blue text-gray-600 leading-8 whitespace-pre-line">
                    {recipe.instructions ? recipe.instructions : (
                        <p className="italic text-gray-400">No instructions have been written for this recipe yet.</p>
                    )}
                </div>
            </div>
        </div>
      </div>
    </div>
  );
}

================
File: web/src/app/recipes/new/page.tsx
================
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { useMutation, useQueryClient, useQuery } from '@tanstack/react-query';
import api from '@/lib/api';
import Link from 'next/link';

// Types matches Backend Schema
interface RecipeIngredientInput {
  ingredient_id?: string; // Optional if creating new
  name: string;           // Required for display & creation
  quantity: string;
  unit: string;
}

interface RecipeCreate {
  title: string;
  servings: number;
  instructions: string;
  ingredients: RecipeIngredientInput[];
}

interface IngredientOption {
  id: string;
  name: string;
  default_unit: string;
}

export default function NewRecipePage() {
  const router = useRouter();
  const queryClient = useQueryClient();

  // --- Form State ---
  const [title, setTitle] = useState('');
  const [servings, setServings] = useState(4);
  const [instructions, setInstructions] = useState('');
  const [ingredients, setIngredients] = useState<RecipeIngredientInput[]>([]);

  // --- Ingredient Input State ---
  const [ingName, setIngName] = useState('');
  const [ingQty, setIngQty] = useState('');
  const [ingUnit, setIngUnit] = useState('');

  // 1. Fetch Existing Ingredients (for Autocomplete/Dropdown)
  const { data: existingIngredients } = useQuery<IngredientOption[]>({
    queryKey: ['ingredients'],
    queryFn: async () => (await api.get('/ingredients')).data,
  });

  // 2. Create Mutation
  const createMutation = useMutation({
    mutationFn: async (newRecipe: RecipeCreate) => {
      return api.post('/recipes', newRecipe);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['recipes'] });
      router.push('/'); // Go back to dashboard
    },
  });

  // Helper: Add Ingredient to Local List
  const handleAddIngredient = (e: React.FormEvent) => {
    e.preventDefault();
    if (!ingName || !ingQty) return;

    // Check if selected name matches an existing ID
    const match = existingIngredients?.find(
      (i) => i.name.toLowerCase() === ingName.toLowerCase()
    );

    const newIng: RecipeIngredientInput = {
      ingredient_id: match?.id, // If match found, use ID
      name: match?.name || ingName, // Proper casing if matched, else user input
      quantity: ingQty,
      unit: ingUnit || match?.default_unit || '',
    };

    setIngredients([...ingredients, newIng]);
    
    // Reset inputs
    setIngName('');
    setIngQty('');
    setIngUnit('');
  };

  const removeIngredient = (index: number) => {
    setIngredients(ingredients.filter((_, i) => i !== index));
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    createMutation.mutate({
      title,
      servings,
      instructions,
      ingredients,
    });
  };

  return (
    <div className="min-h-screen bg-gray-50 p-4 md:p-10 font-sans text-gray-900 flex justify-center">
      <div className="max-w-3xl w-full">
        
        {/* --- Header --- */}
        <div className="flex justify-between items-center mb-6">
          <Link 
            href="/" 
            className="text-sm font-bold text-gray-500 hover:text-gray-900 flex items-center gap-1 transition-colors"
          >
             Cancel
          </Link>
          <h1 className="text-xl font-bold text-gray-900">New Recipe</h1>
          <div className="w-16"></div> {/* Spacer for alignment */}
        </div>

        <form onSubmit={handleSubmit} className="space-y-6">
          
          {/* --- Card 1: Basic Info --- */}
          <div className="bg-white rounded-3xl shadow-sm border border-gray-100 p-6 md:p-8">
            <h2 className="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
              <span className="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-sm">1</span>
              Recipe Details
            </h2>
            
            <div className="space-y-5">
              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">Recipe Title</label>
                <input
                  type="text"
                  value={title}
                  onChange={(e) => setTitle(e.target.value)}
                  placeholder="e.g. Grandma's Lasagna"
                  className="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition font-medium text-lg"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-bold text-gray-700 mb-2">Servings</label>
                <div className="flex items-center gap-4">
                  <button 
                    type="button" 
                    onClick={() => setServings(Math.max(1, servings - 1))}
                    className="w-10 h-10 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold flex items-center justify-center transition"
                  >
                    -
                  </button>
                  <span className="text-xl font-bold text-gray-900 w-8 text-center">{servings}</span>
                  <button 
                    type="button" 
                    onClick={() => setServings(servings + 1)}
                    className="w-10 h-10 rounded-xl bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold flex items-center justify-center transition"
                  >
                    +
                  </button>
                  <span className="text-sm text-gray-500 ml-2">people</span>
                </div>
              </div>
            </div>
          </div>

          {/* --- Card 2: Ingredients --- */}
          <div className="bg-white rounded-3xl shadow-sm border border-gray-100 p-6 md:p-8">
            <h2 className="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
              <span className="bg-green-100 text-green-600 w-8 h-8 rounded-full flex items-center justify-center text-sm">2</span>
              Ingredients
            </h2>

            {/* Ingredient Adder Row */}
            <div className="bg-gray-50 p-4 rounded-2xl border border-gray-200 mb-6">
               <div className="grid grid-cols-1 md:grid-cols-12 gap-3">
                  <div className="md:col-span-6 relative">
                    <input
                      type="text"
                      list="ingredient-options"
                      value={ingName}
                      onChange={(e) => setIngName(e.target.value)}
                      placeholder="Ingredient (e.g. Flour)"
                      className="w-full p-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500"
                    />
                    <datalist id="ingredient-options">
                      {existingIngredients?.map(ing => (
                        <option key={ing.id} value={ing.name} />
                      ))}
                    </datalist>
                  </div>
                  
                  <div className="md:col-span-3">
                     <input
                      type="text"
                      value={ingQty}
                      onChange={(e) => setIngQty(e.target.value)}
                      placeholder="Qty (e.g. 2)"
                      className="w-full p-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500"
                    />
                  </div>

                  <div className="md:col-span-3">
                     <input
                      type="text"
                      value={ingUnit}
                      onChange={(e) => setIngUnit(e.target.value)}
                      placeholder="Unit (e.g. cups)"
                      className="w-full p-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500"
                    />
                  </div>
               </div>
               <button 
                 type="button" // Prevent submitting the whole form
                 onClick={handleAddIngredient}
                 disabled={!ingName || !ingQty}
                 className="w-full mt-3 bg-green-600 text-white font-bold py-3 rounded-xl hover:bg-green-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
               >
                 + Add Ingredient
               </button>
            </div>

            {/* List of Added Ingredients */}
            {ingredients.length === 0 ? (
               <div className="text-center py-8 text-gray-400 border-2 border-dashed border-gray-100 rounded-2xl">
                 No ingredients added yet.
               </div>
            ) : (
              <ul className="space-y-2">
                {ingredients.map((item, idx) => (
                  <li key={idx} className="flex justify-between items-center bg-white p-3 border border-gray-100 rounded-xl shadow-sm">
                    <div className="flex items-center gap-3">
                      <div className="w-8 h-8 rounded-full bg-green-50 text-green-600 flex items-center justify-center font-bold text-xs">
                        {idx + 1}
                      </div>
                      <span className="font-medium text-gray-800">{item.name}</span>
                    </div>
                    <div className="flex items-center gap-4">
                      <span className="text-sm bg-gray-100 px-2 py-1 rounded text-gray-600 font-semibold">
                        {item.quantity} {item.unit}
                      </span>
                      <button
                        type="button"
                        onClick={() => removeIngredient(idx)}
                        className="text-gray-400 hover:text-red-500 transition"
                      >
                        
                      </button>
                    </div>
                  </li>
                ))}
              </ul>
            )}
          </div>

          {/* --- Card 3: Instructions --- */}
          <div className="bg-white rounded-3xl shadow-sm border border-gray-100 p-6 md:p-8">
            <h2 className="text-lg font-bold text-gray-900 mb-6 flex items-center gap-2">
              <span className="bg-purple-100 text-purple-600 w-8 h-8 rounded-full flex items-center justify-center text-sm">3</span>
              Instructions
            </h2>
            <textarea
              value={instructions}
              onChange={(e) => setInstructions(e.target.value)}
              placeholder="Step 1: Preheat the oven..."
              rows={6}
              className="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 transition leading-relaxed resize-none"
            />
          </div>

          {/* --- Submit Button --- */}
          <div className="pt-4 pb-20">
             <button
               type="submit"
               disabled={createMutation.isPending || ingredients.length === 0 || !title}
               className="w-full bg-gray-900 text-white font-bold text-lg py-4 rounded-2xl shadow-xl hover:bg-black transition transform hover:-translate-y-1 disabled:opacity-50 disabled:translate-y-0"
             >
               {createMutation.isPending ? 'Saving Recipe...' : 'Save Recipe'}
             </button>
          </div>

        </form>
      </div>
    </div>
  );
}

================
File: web/src/app/register/page.tsx
================
'use client';

import { useState } from 'react';
import api from '@/lib/api';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

export default function RegisterPage() {
  const router = useRouter();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      await api.post('/auth/register', { email, password });
      router.push('/login');
    } catch (err: any) {
      setError(err.response?.data?.detail || 'Registration failed');
    }
  };

  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-100">
      <div className="w-full max-w-md p-8 space-y-6 bg-white rounded shadow-md text-black">
        <h2 className="text-2xl font-bold text-center">Register</h2>
        {error && <p className="text-red-500 text-center">{error}</p>}
        
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700">Email</label>
            <input 
              type="email" 
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              required 
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Password</label>
            <input 
              type="password" 
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              required 
            />
          </div>
          <button 
            type="submit" 
            className="w-full py-2 text-white bg-green-600 rounded hover:bg-green-700"
          >
            Create Account
          </button>
        </form>
        <p className="text-center text-sm text-gray-600">
          Already have an account? <Link href="/login" className="text-blue-500 hover:underline">Login</Link>
        </p>
      </div>
    </div>
  );
}

================
File: web/src/app/what-can-i-cook/page.tsx
================
'use client';

import { useQuery } from '@tanstack/react-query';
import api from '@/lib/api';
import Link from 'next/link';
import { useAuth } from '@/context/AuthContext';

interface MissingIngredient {
  name: string;
  missing_qty: string;
  unit: string;
}

interface RecipeMatch {
  id: string;
  title: string;
  servings: number;
  match_percentage: number;
  missing_ingredients: MissingIngredient[];
}

export default function WhatCanICook() {
  const { user } = useAuth();

  const { data: suggestions, isLoading } = useQuery<RecipeMatch[]>({
    queryKey: ['recipe-suggestions'],
    queryFn: async () => (await api.get('/recipes/suggestions')).data,
    enabled: !!user
  });

  if (!user) return null;

  return (
    <div className="min-h-screen bg-gray-50 p-8 text-black">
      <div className="max-w-4xl mx-auto">
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-3xl font-bold text-gray-800">What Can I Cook?</h1>
          <Link href="/" className="text-blue-600 hover:underline">
            Back to Dashboard
          </Link>
        </div>

        {isLoading ? (
          <p className="text-gray-500">Analyzing your fridge...</p>
        ) : suggestions?.length === 0 ? (
          <div className="bg-white p-8 rounded shadow text-center">
            <h2 className="text-xl font-semibold mb-2">No matches found.</h2>
            <p className="text-gray-600">Try adding more ingredients to your inventory!</p>
          </div>
        ) : (
          <div className="space-y-6">
            {suggestions?.map((recipe) => (
              <div key={recipe.id} className="bg-white rounded-lg shadow-md p-6 border border-gray-100">
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <h2 className="text-2xl font-bold text-gray-800">{recipe.title}</h2>
                    <p className="text-sm text-gray-500">Serves {recipe.servings}</p>
                  </div>
                  
                  {/* Match Percentage Badge */}
                  <div className={`px-4 py-2 rounded-full font-bold text-white ${
                    recipe.match_percentage === 100 ? 'bg-green-600' :
                    recipe.match_percentage >= 50 ? 'bg-yellow-500' : 'bg-red-500'
                  }`}>
                    {recipe.match_percentage}% Match
                  </div>
                </div>

                {/* Progress Bar */}
                <div className="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                  <div 
                    className={`h-2.5 rounded-full ${
                      recipe.match_percentage === 100 ? 'bg-green-600' :
                      recipe.match_percentage >= 50 ? 'bg-yellow-400' : 'bg-red-400'
                    }`}
                    style={{ width: `${recipe.match_percentage}%` }}
                  ></div>
                </div>

                {/* Missing Ingredients Section */}
                {recipe.match_percentage < 100 && (
                  <div className="bg-red-50 p-4 rounded-lg border border-red-100">
                    <h3 className="text-sm font-bold text-red-800 uppercase mb-2">You are missing:</h3>
                    <ul className="list-disc list-inside text-sm text-red-700 space-y-1">
                      {recipe.missing_ingredients.map((ing, idx) => (
                        <li key={idx}>
                          {ing.missing_qty} {ing.unit} {ing.name}
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
                
                {recipe.match_percentage === 100 && (
                   <div className="text-green-700 font-medium bg-green-50 p-3 rounded border border-green-200">
                      You have everything you need to cook this!
                   </div>
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

================
File: web/src/context/AuthContext.tsx
================
'use client';

import { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import { useRouter } from 'next/navigation';
import Cookies from 'js-cookie';

interface User {
  email: string;
}

interface AuthContextType {
  user: User | null;
  login: (token: string, email: string) => void;
  logout: () => void;
  isLoading: boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const router = useRouter();

  useEffect(() => {
    const token = Cookies.get('token');
    if (token) {
      // For now, we manually set the user since we don't have a /me endpoint yet
      // In the future, we will decode the token or fetch user data here
      setUser({ email: 'user@example.com' }); 
    }
    setIsLoading(false);
  }, []);

  const login = (token: string, email: string) => {
    Cookies.set('token', token, { expires: 1 }); // Expires in 1 day
    setUser({ email });
    router.push('/'); // Redirect to dashboard/home
  };

  const logout = () => {
    Cookies.remove('token');
    setUser(null);
    router.push('/login');
  };

  return (
    <AuthContext.Provider value={{ user, login, logout, isLoading }}>
      {children}
    </AuthContext.Provider>
  );
}

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) throw new Error('useAuth must be used within an AuthProvider');
  return context;
};

================
File: web/src/lib/api.ts
================
import axios from 'axios';
import Cookies from 'js-cookie';

const api = axios.create({
  baseURL: 'http://localhost:8000/api/v1', // Your FastAPI Backend URL
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request Interceptor: Attach Token
api.interceptors.request.use(
  (config) => {
    const token = Cookies.get('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response Interceptor: Handle 401 (Unauthorized)
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Token expired or invalid
      Cookies.remove('token');
      // Optional: Redirect to login if not already there
      if (window.location.pathname !== '/login') {
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);

export default api;

================
File: web/src/lib/providers.tsx
================
'use client';

import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { useState } from 'react';

export default function Providers({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(() => new QueryClient());

  return (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
}

================
File: web/tsconfig.json
================
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}



================================================================
End of Codebase
================================================================
